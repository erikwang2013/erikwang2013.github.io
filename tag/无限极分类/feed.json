{
    "version": "https://jsonfeed.org/version/1",
    "title": "艾瑞可erik • All posts by \"无限极分类\" tag • All posts by \"undefined\" categories",
    "description": "一只PHP开发的程序猿，偶尔做做运维、Goland、Python、Java、摄影、画画、写作、顺便睡觉，反正整站都搞过。",
    "home_page_url": "https://erik.xyz",
    "items": [
        {
            "id": "https://erik.xyz/2019/05/29/wu-xian-ji-fen-lei-chu-li/",
            "url": "https://erik.xyz/2019/05/29/wu-xian-ji-fen-lei-chu-li/",
            "title": "无限极分类处理",
            "date_published": "2019-05-29T11:14:00.000Z",
            "content_html": "<p><img src=\"https://erik.xyz/wp-content/uploads/2019/2019-05-29_18-41.png\" alt=\"\"><br><span id=\"more\"></span></p>\n<p>近期有个关于无限分类关系的统计处理。要求使用树型结构，无奈用了layui的表格展示，外加插件treetable和导出插件excel。<br>针对无限极这块从父级查询子级很长见，但是要从子级查父级一下子懵逼了。<br>自己反复探索了几次。</p>\n<ul>\n<li>上代码。</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$arr = [</span><br><span class=\"line\">    [</span><br><span class=\"line\">        &#x27;id&#x27; =&gt; 1,</span><br><span class=\"line\">        &#x27;parentId&#x27; =&gt; -1,</span><br><span class=\"line\">        &#x27;name&#x27; =&gt; &#x27;广东省&#x27;,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    [</span><br><span class=\"line\">        &#x27;id&#x27; =&gt; 2,</span><br><span class=\"line\">        &#x27;parentId&#x27; =&gt; 1,</span><br><span class=\"line\">        &#x27;name&#x27; =&gt; &#x27;深圳市&#x27;,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    [</span><br><span class=\"line\">        &#x27;id&#x27; =&gt; 3,</span><br><span class=\"line\">        &#x27;parentId&#x27; =&gt; 2,</span><br><span class=\"line\">        &#x27;name&#x27; =&gt; &#x27;南山区&#x27;,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    [</span><br><span class=\"line\">        &#x27;id&#x27; =&gt; 4,</span><br><span class=\"line\">        &#x27;parentId&#x27; =&gt; 3,</span><br><span class=\"line\">        &#x27;name&#x27; =&gt; &#x27;粤海街道办&#x27;,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    [</span><br><span class=\"line\">        &#x27;id&#x27; =&gt; 5,</span><br><span class=\"line\">        &#x27;parentId&#x27; =&gt; -1,</span><br><span class=\"line\">        &#x27;name&#x27; =&gt; &#x27;江西省&#x27;,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    [</span><br><span class=\"line\">        &#x27;id&#x27; =&gt; 6,</span><br><span class=\"line\">        &#x27;parentId&#x27; =&gt; 5,</span><br><span class=\"line\">        &#x27;name&#x27; =&gt; &#x27;吉安市&#x27;,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    [</span><br><span class=\"line\">        &#x27;id&#x27; =&gt; 7,</span><br><span class=\"line\">        &#x27;parentId&#x27; =&gt; 6,</span><br><span class=\"line\">        &#x27;name&#x27; =&gt; &#x27;吉州区&#x27;,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    [</span><br><span class=\"line\">        &#x27;id&#x27; =&gt; 8,</span><br><span class=\"line\">        &#x27;parentId&#x27; =&gt; 7,</span><br><span class=\"line\">        &#x27;name&#x27; =&gt; &#x27;河东街道办&#x27;,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    [</span><br><span class=\"line\">        &#x27;id&#x27; =&gt; 9,</span><br><span class=\"line\">        &#x27;parentId&#x27; =&gt; 3,</span><br><span class=\"line\">        &#x27;name&#x27; =&gt; &#x27;西丽街道办&#x27;,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    [</span><br><span class=\"line\">        &#x27;id&#x27; =&gt; 10,</span><br><span class=\"line\">        &#x27;parentId&#x27; =&gt; 7,</span><br><span class=\"line\">        &#x27;name&#x27; =&gt; &#x27;文山街道办&#x27;,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    [</span><br><span class=\"line\">        &#x27;id&#x27; =&gt; 11,</span><br><span class=\"line\">        &#x27;parentId&#x27; =&gt; 6,</span><br><span class=\"line\">        &#x27;name&#x27; =&gt; &#x27;青原区&#x27;,</span><br><span class=\"line\">    ]</span><br><span class=\"line\">];</span><br><span class=\"line\">//提取id为键</span><br><span class=\"line\">function changeData($data)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $lists = [];</span><br><span class=\"line\">    foreach ($data as $k =&gt; $v) &#123;</span><br><span class=\"line\">        $lists[$v[&#x27;id&#x27;]] = $v;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return $lists;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">//父级查询子级</span><br><span class=\"line\">function getParent($data)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $list = changeData($data);</span><br><span class=\"line\">    $tree = [];</span><br><span class=\"line\">    foreach ($list as $k) &#123;</span><br><span class=\"line\">        if (isset($list[$k[&#x27;parentId&#x27;]]) &amp;&amp; $k[&#x27;parentId&#x27;] != -1) &#123;</span><br><span class=\"line\">            $list[$k[&#x27;parentId&#x27;]][&#x27;items&#x27;][$k[&#x27;id&#x27;]] =&amp; $list[$k[&#x27;id&#x27;]];</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            $tree[$k[&#x27;id&#x27;]] =&amp; $list[$k[&#x27;id&#x27;]];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return $tree;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">//子级查询父级</span><br><span class=\"line\">function getChild($data)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $list = changeData($data);</span><br><span class=\"line\">    $tree = [];</span><br><span class=\"line\">    foreach ($list as $k =&gt; $v) &#123;</span><br><span class=\"line\">        if ($v[&#x27;parentId&#x27;] != -1) &#123;</span><br><span class=\"line\">            $list[$v[&#x27;id&#x27;]][&#x27;items&#x27;][$v[&#x27;parentId&#x27;]] =&amp; $list[$v[&#x27;parentId&#x27;]];</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            $tree =&amp; $list;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return $tree;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">//组合子级到父级关系</span><br><span class=\"line\">function getData($gets)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $list = [];</span><br><span class=\"line\">    $tem = &#x27;&#x27;;</span><br><span class=\"line\">    foreach ($gets as $k =&gt; $v) &#123;</span><br><span class=\"line\">        if ($v[&#x27;parentId&#x27;] != -1) &#123;</span><br><span class=\"line\">            $temp = $v[&#x27;name&#x27;];</span><br><span class=\"line\">            if (count($v[&#x27;items&#x27;]) &gt; 0) &#123;</span><br><span class=\"line\">                $tem = $v[&#x27;items&#x27;][$v[&#x27;parentId&#x27;]][&#x27;name&#x27;];</span><br><span class=\"line\">                if (count($v[&#x27;items&#x27;][$v[&#x27;parentId&#x27;]][&#x27;items&#x27;]) &gt; 0) &#123;</span><br><span class=\"line\">                    $tp = getData($v[&#x27;items&#x27;][$v[&#x27;parentId&#x27;]][&#x27;items&#x27;]);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            if (empty($tem)) &#123;</span><br><span class=\"line\">                $tems = $v[&#x27;name&#x27;];</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                $tems = $temp . &#x27;-&gt;&#x27; . $tem;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            if (count($tp) &gt; 0) &#123;</span><br><span class=\"line\">                $list[] = $tems . &#x27;-&gt;&#x27; . $tp[0];</span><br><span class=\"line\">                unset($tp);</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                $list[] = $tems;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            $list[] = $v[&#x27;name&#x27;];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return $list;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$gets = getChild($arr);;</span><br><span class=\"line\">$ss = getData($gets);</span><br><span class=\"line\">print_r($ss);</span><br><span class=\"line\">exit;</span><br></pre></td></tr></table></figure>",
            "tags": [
                "php",
                "无限极分类",
                "php无限极",
                "分类tree",
                "无限极分类树型"
            ]
        }
    ]
}