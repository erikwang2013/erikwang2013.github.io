{
    "version": "https://jsonfeed.org/version/1",
    "title": "艾瑞可erik • All posts by \"php服务器\" tag • All posts by \"undefined\" categories",
    "description": "一只PHP开发的程序猿，偶尔做做运维、Goland、Python、Java、摄影、画画、写作、顺便睡觉，反正整站都搞过。",
    "home_page_url": "https://erik.xyz",
    "items": [
        {
            "id": "https://erik.xyz/2015/03/15/centos-da-jian-svn-fu-wu-qi/",
            "url": "https://erik.xyz/2015/03/15/centos-da-jian-svn-fu-wu-qi/",
            "title": "centos搭建svn服务器",
            "date_published": "2015-03-15T04:27:00.000Z",
            "content_html": "<p>在centos中搭建svn服务器 在终端输入 yum install subversion 安装完毕 <a href=\"http://i2.tietuku.com/793f012274070e04.png\"><img src=\"http://i2.tietuku.com/793f012274070e04.png\" alt=\"\"></a> </p>\n<p>输入 subversion -v 判断是否安装成功 接着会出现提示   -bash: subversion: command not found   </p>\n<p>查找 输入 svnserve –version   出现提示 svnserve，版本 1.6.11 (r934486) 编译于 Feb 10 2015，22:08:22     版权所有 (C) 2000-2009 CollabNet。 Subversion 是开放源代码软件，请参阅 <a href=\"http://subversion.tigris.org/\">http://subversion.tigris.org/</a> 站点。 此产品包含由 CollabNet(<a href=\"http://www.Collab.Net/\">http://www.Collab.Net/</a>) 开发的软件。  <span id=\"more\"></span>  </p>\n<p>下列版本库后端(FS) 模块可用:     <em> fs_base : 模块只能操作BDB版本库。 </em> fs_fs : 模块与文本文件(FSFS)版本库一起工作。     Cyrus SASL 认证可用。   </p>\n<p>有了svn软件还要建立svn库<br>命令 mkdir /opt/svn/repos   svnadmin create /opt/svn/repos<br>执行后生成多个文件在repos下<br>接下来配置一下 进入配置文件passwd   cd /opt/svn/repos/conf<br>编辑 passwd   vi passwd<br>在[users]下创建用户名 密码 <a href=\"http://i2.tietuku.com/4fc1a7855d996b1a.png\"><img src=\"http://i2.tietuku.com/4fc1a7855d996b1a.png\" alt=\"\"></a><br>创建成功，保存，退出 设置权限   vi authz <a href=\"http://i2.tietuku.com/1fca22354b1e4fa5.png\"><img src=\"http://i2.tietuku.com/1fca22354b1e4fa5.png\" alt=\"\"></a><br>最后设定 svnserve.conf<br>anon-access = none # 使非授权用户无法访问<br>auth-access = write # 使授权用户有写权限<br>password-db = password authz-db = authz   # 访问控制文件<br>realm = /opt/svn/repos # 认证命名空间，subversion会在认证提示里显示，并且作为凭证缓存的关键字<br>连接 启动 svnserve -d -r /opt/svn/repos 或 svnserve -d -r /opt/svn/repos —listen-port 3391</p>\n",
            "tags": [
                "php服务器",
                "centos"
            ]
        },
        {
            "id": "https://erik.xyz/2015/02/05/windows-shang-jing-tai-bian-yi-libevent-2-0-10-bing-shi-xian-yi-ge-jian-dan-http-fu-wu-qi/",
            "url": "https://erik.xyz/2015/02/05/windows-shang-jing-tai-bian-yi-libevent-2-0-10-bing-shi-xian-yi-ge-jian-dan-http-fu-wu-qi/",
            "title": "Windows 上静态编译 Libevent 2.0.10 并实现一个简单 HTTP 服务器",
            "date_published": "2015-02-05T15:51:00.000Z",
            "content_html": "<p>[文章作者：张宴 ] 本文介绍了如何在 Windows 操作系统中，利用微软 Visual Studio 2005 编译生成 <a href=\"http://monkey.org/%7Eprovos/libevent/\">Libevent</a> 2.0.10 静态链接库，并利用 <a href=\"http://monkey.org/%7Eprovos/libevent/\">Libevent</a> 静态链接库，实现一个简单的 HTTP Web服务器程序：httpd.exe。 假设 Visual Studio 2005 的安装路径为“D:\\Program Files\\Microsoft Visual Studio 8\\”，<a href=\"http://monkey.org/%7Eprovos/libevent/\">Libevent</a> 2.0.10 解压后的路径为“D:\\libevent-2.0.10-stable”。<br><span id=\"more\"></span></p>\n<hr>\n<p><strong>一、编译生成 Libevent 2.0.10 静态链接库。</strong> </p>\n<ol>\n<li><p>修改“D:\\libevent-2.0.10-stable\\event_iocp.c”、“D:\\libevent-2.0.10-stable \\evthread_win32.c”、“D:\\libevent-2.0.10-stable\\listener.c”三个文件，在文件开头分别加上一 行：</p>\n<h1 id=\"define-WIN32-WINNT-0x0500\"><a href=\"#define-WIN32-WINNT-0x0500\" class=\"headerlink\" title=\"define _WIN32_WINNT 0x0500\"></a>define _WIN32_WINNT 0x0500</h1></li>\n<li><p>鼠标点击Windows左下角的【开始】-【所有程序】，找到【Microsoft Visual Studio 2005】，执行下图中的脚本： </p>\n<p><a href=\"http://zyan.cc/attachment/201103/libevent/libevent1.png\"><img src=\"http://zyan.cc/attachment/201103/libevent/libevent1.png\" alt=\"点击在新窗口中浏览此图片\" title=\"点击在新窗口中浏览此图片\"></a> </p>\n</li>\n<li><p>按照下图中的方法编译Libevent 2.0.10：<br><a href=\"http://zyan.cc/attachment/201103/libevent/libevent2.png\"><img src=\"http://zyan.cc/attachment/201103/libevent/libevent2.png\" alt=\"点击在新窗口中浏览此图片\" title=\"点击在新窗口中浏览此图片\"></a> </p>\n</li>\n<li><p>生成的“libevent.lib”、“libevent_core.lib”、“libevent_extras.lib”三个文件就是我们需要的 Libevent 静态链接库。<br><a href=\"http://zyan.cc/attachment/201103/libevent/libevent3.png\"><img src=\"http://zyan.cc/attachment/201103/libevent/libevent3.png\" alt=\"点击在新窗口中浏览此图片\" title=\"点击在新窗口中浏览此图片\"></a></p>\n</li>\n</ol>\n<hr>\n<p><strong>二、利用 Libevent 静态链接库，实现一个简单的 HTTP Web服务器程序</strong> </p>\n<ol>\n<li><p>打开 Visual Studio 2005，新建一个项目<br><a href=\"http://zyan.cc/attachment/201103/libevent/libevent4.png\"><img src=\"http://zyan.cc/attachment/201103/libevent/libevent4.png\" alt=\"点击在新窗口中浏览此图片\" title=\"点击在新窗口中浏览此图片\"></a></p>\n</li>\n<li><p>选择在“d:\\test”目录内创建一个“Win32 控制台应用程序”<br><a href=\"http://zyan.cc/attachment/201103/libevent/libevent5.png\"><img src=\"http://zyan.cc/attachment/201103/libevent/libevent5.png\" alt=\"点击在新窗口中浏览此图片\" title=\"点击在新窗口中浏览此图片\"></a> </p>\n</li>\n<li><p>按照下图进行选择<br><a href=\"http://zyan.cc/attachment/201103/libevent/libevent6.png\"><img src=\"http://zyan.cc/attachment/201103/libevent/libevent6.png\" alt=\"点击在新窗口中浏览此图片\" title=\"点击在新窗口中浏览此图片\"></a> </p>\n</li>\n<li><p>创建完成项目后，会自动生成“d:\\test\\httpd\\”目录，在该目录内创建一个“httpd.c”文件，内容如下：<br> <a href=\"http://zyan.cc/#\">view plain</a><a href=\"http://zyan.cc/#\">print</a><a href=\"http://zyan.cc/#\">?</a></p>\n</li>\n</ol>\n<pre><code>  #include &lt;stdio.h&gt;\n\n      #define WIN32\\_LEAN\\_AND_MEAN\n     #include &lt;windows.h&gt;\n      #include &lt;winsock2.h&gt;\n\n      #include &lt;event.h&gt;\n      #include &lt;evhttp.h&gt;\n\n      void root_handler(struct evhttp_request *req, void *arg)\n      &#123;\n          struct evbuffer *buf = evbuffer_new();\n          if(!buf)&#123;\n              puts(&quot;failed to create response buffer&quot;);\n              return;\n          &#125;\n\n          evbuffer\\_add\\_printf(buf, &quot;Hello: %s\\\\n&quot;, evhttp\\_request\\_uri(req));\n          evhttp\\_send\\_reply(req, HTTP_OK, &quot;OK&quot;, buf);\n      &#125;\n\n      void generic_handler(struct evhttp_request *req, void *arg)\n      &#123;\n          struct evbuffer *buf = evbuffer_new();\n          if(!buf)&#123;\n              puts(&quot;failed to create response buffer&quot;);\n              return;\n          &#125;\n\n          evbuffer\\_add\\_printf(buf, &quot;Requested: %s\\\\n&quot;, evhttp\\_request\\_uri(req));\n          evhttp\\_send\\_reply(req, HTTP_OK, &quot;OK&quot;, buf);\n      &#125;\n\n      int main(int argc, wchar_t* argv\\[\\])\n      &#123;\n        struct evhttp *httpd;\n\n        WSADATA wsaData;\n        DWORD Ret;\n        if ((Ret = WSAStartup(MAKEWORD(2, 2), &amp;wsaData)) != 0)  &#123;\n          printf(&quot;WSAStartup failed with error %d\\\\n&quot;, Ret);\n          return -1;\n        &#125;\n\n          event_init();\n\n          httpd = evhttp_start(&quot;0.0.0.0&quot;, 8505);\n          if(!httpd)&#123;\n          return 1;\n        &#125;\n\n          evhttp\\_set\\_cb(httpd, &quot;/&quot;, root_handler, NULL);\n          evhttp\\_set\\_gencb(httpd, generic_handler, NULL);\n\n        printf(&quot;httpd server start OK!\\\\n&quot;);\n\n          event_dispatch();\n\n          evhttp_free(httpd);\n\n        WSACleanup();\n          return 0;\n   &#125;\n</code></pre><p>5、回到 Visual Studio 2005，在左侧的【源文件】中选择【添加】-【现有项】，将上一步创建的“httpd.c”文件添加进来。</p>\n<p> <a href=\"http://zyan.cc/attachment/201103/libevent/libevent7.png\"><img src=\"http://zyan.cc/attachment/201103/libevent/libevent7.png\" alt=\"点击在新窗口中浏览此图片\" title=\"点击在新窗口中浏览此图片\"></a> </p>\n<p>6、在【解决方案“httpd”】上点击鼠标右键，选择【属性】 </p>\n<p><a href=\"http://zyan.cc/attachment/201103/libevent/libevent8.png\"><img src=\"http://zyan.cc/attachment/201103/libevent/libevent8.png\" alt=\"点击在新窗口中浏览此图片\" title=\"点击在新窗口中浏览此图片\"></a> </p>\n<p>7、将【配置】改为“Release”</p>\n<p><a href=\"http://zyan.cc/attachment/201103/libevent/libevent9.png\"><img src=\"http://zyan.cc/attachment/201103/libevent/libevent9.png\" alt=\"点击在新窗口中浏览此图片\" title=\"点击在新窗口中浏览此图片\"></a> </p>\n<p>8、将“D:\\libevent-2.0.10-stable\\include”整个目录复制到“D:\\test\\httpd\\include”；将 “D:\\libevent-2.0.10-stable\\WIN32-Code”目录内的“tree.h”文件和“event2”子目录，复制到“D: \\test\\httpd\\include\\”内；将“D:\\libevent-2.0.10-stable\\”目录内的所有“*.h”头文件复制到“D: \\test\\httpd\\include\\”内。可以在Windows左下角的【开始】-【运行】中输入“cmd”回车，在命令行窗口中执行以下命令，完 成复制过程。</p>\n<p>mkdir D:\\test\\httpd\\include\\ xcopy /E /H /R D:\\libevent-2.0.10-stable\\include\\<em> D:\\test\\httpd\\include\\ xcopy /E /H /R D:\\libevent-2.0.10-stable\\WIN32-Code\\</em> D:\\test\\httpd\\include\\ xcopy /E /H /R D:\\libevent-2.0.10-stable\\*.h D:\\test\\httpd\\include\\</p>\n<p><a href=\"http://zyan.cc/attachment/201103/libevent/libevent10.png\"><img src=\"http://zyan.cc/attachment/201103/libevent/libevent10.png\" alt=\"点击在新窗口中浏览此图片\" title=\"点击在新窗口中浏览此图片\"></a></p>\n<p><a href=\"http://zyan.cc/attachment/201103/libevent/libevent11.png\"><img src=\"http://zyan.cc/attachment/201103/libevent/libevent11.png\" alt=\"点击在新窗口中浏览此图片\" title=\"点击在新窗口中浏览此图片\"></a> </p>\n<p>9、回到 Visual Studio 2005，在左侧菜单中【解决方案“httpd”】下面一行【httpd】上点击鼠标邮件，选择【属性】，对每项内容进行修改。下图中红框内的数据即为修改后的数据。 </p>\n<p><a href=\"http://zyan.cc/attachment/201103/libevent/libevent12.png\"><img src=\"http://zyan.cc/attachment/201103/libevent/libevent12.png\" alt=\"点击在新窗口中浏览此图片\" title=\"点击在新窗口中浏览此图片\"></a> </p>\n<p><a href=\"http://zyan.cc/attachment/201103/libevent/libevent13.png\"><img src=\"http://zyan.cc/attachment/201103/libevent/libevent13.png\" alt=\"点击在新窗口中浏览此图片\" title=\"点击在新窗口中浏览此图片\"></a> </p>\n<p><a href=\"http://zyan.cc/attachment/201103/libevent/libevent14.png\"><img src=\"http://zyan.cc/attachment/201103/libevent/libevent14.png\" alt=\"点击在新窗口中浏览此图片\" title=\"点击在新窗口中浏览此图片\"></a> </p>\n<p><a href=\"http://zyan.cc/attachment/201103/libevent/libevent15.png\"><img src=\"http://zyan.cc/attachment/201103/libevent/libevent15.png\" alt=\"点击在新窗口中浏览此图片\" title=\"点击在新窗口中浏览此图片\"></a></p>\n<p>注：下图中，附加依赖项填写：</p>\n<pre><code>    ws2\\_32.lib wsock32.lib libevent.lib libevent\\_core.lib libevent_extras.lib\n</code></pre><p>忽略特定库填写：</p>\n<p>libc.lib;msvcrt.lib;libcd.lib;libcmtd.lib;msvcrtd.lib</p>\n<p><a href=\"http://zyan.cc/attachment/201103/libevent/libevent16.png\"><img src=\"http://zyan.cc/attachment/201103/libevent/libevent16.png\" alt=\"点击在新窗口中浏览此图片\" title=\"点击在新窗口中浏览此图片\"></a></p>\n<p>10、完成设置后，在【解决方案“httpd”】上点击鼠标右键，选择【生成解决方案】。如果是重新编译，可以选择【重新生成解决方案】。生成成功后，“d:\\test\\httpd\\Release”目录内的“httpd.exe”即为生成的可执行文件。 </p>\n<p><a href=\"http://zyan.cc/attachment/201103/libevent/libevent17.png\"><img src=\"http://zyan.cc/attachment/201103/libevent/libevent17.png\" alt=\"点击在新窗口中浏览此图片\" title=\"点击在新窗口中浏览此图片\"></a> </p>\n<p>11、双击“httpd.exe”运行后，打开浏览器，访问“<a href=\"http://127.0.0.1:8505/\">http://127.0.0.1:8505/</a>”，则可以看到以下信息：一个简单的 HTTP Web Server 输出的内容。</p>\n<p><a href=\"http://zyan.cc/attachment/201103/libevent/libevent18.png\"><img src=\"http://zyan.cc/attachment/201103/libevent/libevent18.png\" alt=\"点击在新窗口中浏览此图片\" title=\"点击在新窗口中浏览此图片\"></a> </p>\n<p>12、如果你觉得像DOS程序一样的“httpd.exe”可执行文件图标不好看、没有显示版本信息，那么，你可以按照下图步骤，添加ICO图标文件。 </p>\n<p><a href=\"http://zyan.cc/attachment/201103/libevent/libevent19.png\"><img src=\"http://zyan.cc/attachment/201103/libevent/libevent19.png\" alt=\"点击在新窗口中浏览此图片\" title=\"点击在新窗口中浏览此图片\"></a> </p>\n<p><a href=\"http://zyan.cc/attachment/201103/libevent/libevent20.png\"><img src=\"http://zyan.cc/attachment/201103/libevent/libevent20.png\" alt=\"点击在新窗口中浏览此图片\" title=\"点击在新窗口中浏览此图片\"></a> </p>\n<p>13、添加版本信息 </p>\n<p><a href=\"http://zyan.cc/attachment/201103/libevent/libevent21.png\"><img src=\"http://zyan.cc/attachment/201103/libevent/libevent21.png\" alt=\"点击在新窗口中浏览此图片\" title=\"点击在新窗口中浏览此图片\"></a> </p>\n<p><a href=\"http://zyan.cc/attachment/201103/libevent/libevent22.png\"><img src=\"http://zyan.cc/attachment/201103/libevent/libevent22.png\" alt=\"点击在新窗口中浏览此图片\" title=\"点击在新窗口中浏览此图片\"></a> </p>\n<p>14、大功告成，下面显示的是带有自定义图标、版本信息的“httpd.exe”可执行程序。 <a href=\"http://zyan.cc/attachment/201103/libevent/libevent23.png\"><img src=\"http://zyan.cc/attachment/201103/libevent/libevent23.png\" alt=\"点击在新窗口中浏览此图片\" title=\"点击在新窗口中浏览此图片\"></a></p>\n<hr>\n<p><strong>附1：编译好的 Libevent 2.0.10 静态链接库与 httpd 的 Visual Studio 2005 工程源代码下载</strong></p>\n<p><img src=\"http://zyan.cc/template/RuiPai/images/download.gif\" alt=\"\">下载文件</p>\n<p><a href=\"http://blog.zyan.cc/attachment/201103/libevent/httpd.zip\">点击这里下载文件</a></p>\n<p><strong>附2：ICO图标制作工具下载</strong></p>\n<p><img src=\"http://zyan.cc/template/RuiPai/images/download.gif\" alt=\"\">下载文件</p>\n<p><a href=\"http://blog.zyan.cc/attachment/201103/libevent/iconxp.zip\">点击这里下载文件</a></p>\n<p>转载请注明原文链接：<a href=\"http://blog.zyan.cc/libevent_windows/\">http://blog.zyan.cc/libevent_windows/</a></p>\n",
            "tags": [
                "php服务器",
                "http",
                "http服务器"
            ]
        },
        {
            "id": "https://erik.xyz/2015/01/19/yi-ge-fa-song-html-you-jian-de-php-han-shu/",
            "url": "https://erik.xyz/2015/01/19/yi-ge-fa-song-html-you-jian-de-php-han-shu/",
            "title": "一个发送HTML邮件的PHP函数",
            "date_published": "2015-01-19T14:54:00.000Z",
            "content_html": "<p>by <a href=\"http://zyan.cc/user/2/\">张宴</a> 写了一个简单的发送HTML邮件的PHP函数。 函数说明：send_mail(“发件人地址”, “收件人地址”, “邮件主题”, “邮件正文”); 示例：send_mail($from, “info@zyan.cc”, “这是邮件的主题”, “<html><head></head><body><p><font color=red>这是邮件正文</font></p></body></html>“); 代码如下：</p>\n<p><a href=\"http://zyan.cc/#\">view plain</a><a href=\"http://zyan.cc/#\">print</a><a href=\"http://zyan.cc/#\">?</a><span id=\"more\"></span><br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">function send_mail($from, $to, $subject, $message)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    if ($from == &quot;&quot;)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        $from = &#x27;回忆未来 &lt;webmaster@zyan.cc&gt;&#x27;;//发件人地址</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    $headers = &#x27;MIME-Version: 1.0&#x27; . &quot;\\\\r\\\\n&quot;;</span><br><span class=\"line\">    $headers .= &#x27;Content-type: text/html; charset=gb2312&#x27; . &quot;\\\\r\\\\n&quot;;</span><br><span class=\"line\">    $headers .= &#x27;From: &#x27; . $from . &quot;\\\\r\\\\n&quot;;</span><br><span class=\"line\">    mail($to, $subject, $message, $headers);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n",
            "tags": [
                "php服务器",
                "发邮件",
                "邮件函数"
            ]
        },
        {
            "id": "https://erik.xyz/2014/12/29/21-ge-shi-yong-bian-li-de-php-dai-ma/",
            "url": "https://erik.xyz/2014/12/29/21-ge-shi-yong-bian-li-de-php-dai-ma/",
            "title": "21个实用便利的PHP代码",
            "date_published": "2014-12-29T14:07:00.000Z",
            "content_html": "<p>作者: <a href=\"http://paranimage.com/author/admin/\" title=\"由帕兰发布\">帕兰</a></p>\n<h3 id=\"1-PHP可阅读随机字符串\"><a href=\"#1-PHP可阅读随机字符串\" class=\"headerlink\" title=\"1. PHP可阅读随机字符串\"></a>1. PHP可阅读随机字符串</h3><p>此代码将创建一个可阅读的字符串，使其更接近词典中的单词，实用且具有密码验证功能。</p>\n<pre><code>/**************\n*@length - length of random string (must be a multiple of 2)\n**************/\nfunction readable_random_string($length = 6)&#123;\n    $conso=array(&quot;b&quot;,&quot;c&quot;,&quot;d&quot;,&quot;f&quot;,&quot;g&quot;,&quot;h&quot;,&quot;j&quot;,&quot;k&quot;,&quot;l&quot;,\n    &quot;m&quot;,&quot;n&quot;,&quot;p&quot;,&quot;r&quot;,&quot;s&quot;,&quot;t&quot;,&quot;v&quot;,&quot;w&quot;,&quot;x&quot;,&quot;y&quot;,&quot;z&quot;);\n    $vocal=array(&quot;a&quot;,&quot;e&quot;,&quot;i&quot;,&quot;o&quot;,&quot;u&quot;);\n    $password=&quot;&quot;;\n    srand ((double)microtime()*1000000);\n    $max = $length/2;\n    for($i=1; $i&lt;=$max; $i++)\n    &#123;\n    $password.=$conso[rand(0,19)];\n    $password.=$vocal[rand(0,4)];\n    &#125;\n    return $password;\n&#125;\n</code></pre><span id=\"more\"></span>\n<h3 id=\"2-PHP生成一个随机字符串\"><a href=\"#2-PHP生成一个随机字符串\" class=\"headerlink\" title=\"2. PHP生成一个随机字符串\"></a>2. PHP生成一个随机字符串</h3><p>如果不需要可阅读的字符串，使用此函数替代，即可创建一个随机字符串，作为用户的随机密码等。</p>\n<pre><code>/*************\n*@l - length of random string\n*/\nfunction generate_rand($l)&#123;\n  $c= &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&quot;;\n  srand((double)microtime()*1000000);\n  for($i=0; $i&lt;$l; $i++) &#123;\n      $rand.= $c[rand()%strlen($c)];\n  &#125;\n  return $rand;\n &#125;\n</code></pre><h3 id=\"3-PHP编码电子邮件地址\"><a href=\"#3-PHP编码电子邮件地址\" class=\"headerlink\" title=\"3. PHP编码电子邮件地址\"></a>3. PHP编码电子邮件地址</h3><p>使用此代码，可以将任何电子邮件地址编码为 HTML 字符实体，以防止被垃圾邮件程序收集。</p>\n<pre><code>function encode_email($email=&#39;info@domain.com&#39;, $linkText=&#39;Contact Us&#39;, $attrs =&#39;class=&quot;emailencoder&quot;&#39; )\n&#123;\n    // remplazar aroba y puntos\n    $email = str_replace(&#39;@&#39;, &#39;&amp;#64;&#39;, $email);\n    $email = str_replace(&#39;.&#39;, &#39;&amp;#46;&#39;, $email);\n    $email = str_split($email, 5);  \n\n    $linkText = str_replace(&#39;@&#39;, &#39;&amp;#64;&#39;, $linkText);\n    $linkText = str_replace(&#39;.&#39;, &#39;&amp;#46;&#39;, $linkText);\n    $linkText = str_split($linkText, 5);  \n\n    $part1 = &#39;&lt;a href=&quot;ma&#39;;\n    $part2 = &#39;ilto&amp;#58;&#39;;\n    $part3 = &#39;&quot; &#39;. $attrs .&#39; &gt;&#39;;\n    $part4 = &#39;&lt;/a&gt;&#39;;  \n\n    $encoded = &#39;&lt;script type=&quot;text/javascript&quot;&gt;&#39;;\n    $encoded .= &quot;document.write(&#39;$part1&#39;);&quot;;\n    $encoded .= &quot;document.write(&#39;$part2&#39;);&quot;;\n    foreach($email as $e)\n    &#123;\n            $encoded .= &quot;document.write(&#39;$e&#39;);&quot;;\n    &#125;\n    $encoded .= &quot;document.write(&#39;$part3&#39;);&quot;;\n    foreach($linkText as $l)\n    &#123;\n            $encoded .= &quot;document.write(&#39;$l&#39;);&quot;;\n    &#125;\n    $encoded .= &quot;document.write(&#39;$part4&#39;);&quot;;\n    $encoded .= &#39;&lt;/script&gt;&#39;;  \n\n    return $encoded;\n&#125;\n</code></pre><h3 id=\"4-PHP验证邮件地址\"><a href=\"#4-PHP验证邮件地址\" class=\"headerlink\" title=\"4. PHP验证邮件地址\"></a>4. PHP验证邮件地址</h3><p>电子邮件验证也许是中最常用的网页表单验证，此代码除了验证电子邮件地址，也可以选择检查邮件域所属 DNS 中的 MX 记录，使邮件验证功能更加强大。</p>\n<pre><code>function is_valid_email($email, $test_mx = false)\n&#123;\n    if(eregi(&quot;^([_a-z0-9-]+)(\\.[_a-z0-9-]+)*@([a-z0-9-]+)(\\.[a-z0-9-]+)*(\\.[a-z]&#123;2,4&#125;)$&quot;, $email))\n        if($test_mx)\n        &#123;\n            list($username, $domain) = split(&quot;@&quot;, $email);\n            return getmxrr($domain, $mxrecords);\n        &#125;\n        else\n            return true;\n    else\n        return false;\n&#125;\n</code></pre><h3 id=\"5-PHP列出目录内容\"><a href=\"#5-PHP列出目录内容\" class=\"headerlink\" title=\"5. PHP列出目录内容\"></a>5. PHP列出目录内容</h3><pre><code>function list_files($dir)\n&#123;\n    if(is_dir($dir))\n    &#123;\n        if($handle = opendir($dir))\n        &#123;\n            while(($file = readdir($handle)) !== false)\n            &#123;\n                if($file != &quot;.&quot; &amp;&amp; $file != &quot;..&quot; &amp;&amp; $file != &quot;Thumbs.db&quot;)\n                &#123;\n                    echo &#39;&lt;a target=&quot;_blank&quot; href=&quot;&#39;.$dir.$file.&#39;&quot;&gt;&#39;.$file.&#39;&lt;/a&gt;&lt;br&gt;&#39;.&quot;\\n&quot;;\n                &#125;\n            &#125;\n            closedir($handle);\n        &#125;\n    &#125;\n&#125;\n</code></pre><h3 id=\"6-PHP销毁目录\"><a href=\"#6-PHP销毁目录\" class=\"headerlink\" title=\"6. PHP销毁目录\"></a>6. PHP销毁目录</h3><p>删除一个目录，包括它的内容。</p>\n<pre><code>/*****\n*@dir - Directory to destroy\n*@virtual[optional]- whether a virtual directory\n*/\nfunction destroyDir($dir, $virtual = false)\n&#123;\n    $ds = DIRECTORY_SEPARATOR;\n    $dir = $virtual ? realpath($dir) : $dir;\n    $dir = substr($dir, -1) == $ds ? substr($dir, 0, -1) : $dir;\n    if (is_dir($dir) &amp;&amp; $handle = opendir($dir))\n    &#123;\n        while ($file = readdir($handle))\n        &#123;\n            if ($file == &#39;.&#39; || $file == &#39;..&#39;)\n            &#123;\n                continue;\n            &#125;\n            elseif (is_dir($dir.$ds.$file))\n            &#123;\n                destroyDir($dir.$ds.$file);\n            &#125;\n            else\n            &#123;\n                unlink($dir.$ds.$file);\n            &#125;\n        &#125;\n        closedir($handle);\n        rmdir($dir);\n        return true;\n    &#125;\n    else\n    &#123;\n        return false;\n    &#125;\n&#125;\n</code></pre><h3 id=\"7-PHP解析-JSON-数据\"><a href=\"#7-PHP解析-JSON-数据\" class=\"headerlink\" title=\"7. PHP解析 JSON 数据\"></a>7. PHP解析 JSON 数据</h3><p>与大多数流行的 Web 服务如 Twitter 通过开放 API 来提供数据一样，它总是能够知道如何解析 API 数据的各种传送格式，包括 JSON，XML 等等。</p>\n<pre><code>$json_string=&#39;&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;foo&quot;,&quot;email&quot;:&quot;foo@foobar.com&quot;,&quot;interest&quot;:[&quot;wordpress&quot;,&quot;php&quot;]&#125; &#39;;\n$obj=json_decode($json_string);\necho $obj-&gt;name; //prints foo\necho $obj-&gt;interest[1]; //prints php\n</code></pre><h3 id=\"8-PHP解析-XML-数据\"><a href=\"#8-PHP解析-XML-数据\" class=\"headerlink\" title=\"8. PHP解析 XML 数据\"></a>8. PHP解析 XML 数据</h3><pre><code>//xml string\n$xml_string=&quot;&lt;?xml version=&#39;1.0&#39;?&gt;\n&lt;users&gt;\n   &lt;user id=&#39;398&#39;&gt;\n      &lt;name&gt;Foo&lt;/name&gt;\n      &lt;email&gt;foo@bar.com&lt;/name&gt;\n   &lt;/user&gt;\n   &lt;user id=&#39;867&#39;&gt;\n      &lt;name&gt;Foobar&lt;/name&gt;\n      &lt;email&gt;foobar@foo.com&lt;/name&gt;\n   &lt;/user&gt;\n&lt;/users&gt;&quot;;  \n\n//load the xml string using simplexml\n$xml = simplexml_load_string($xml_string);  \n\n//loop through the each node of user\nforeach ($xml-&gt;user as $user)\n&#123;\n   //access attribute\n   echo $user[&#39;id&#39;], &#39;  &#39;;\n   //subnodes are accessed by -&gt; operator\n   echo $user-&gt;name, &#39;  &#39;;\n   echo $user-&gt;email, &#39;&lt;br /&gt;&#39;;\n&#125;\n</code></pre><h3 id=\"9-PHP创建日志缩略名\"><a href=\"#9-PHP创建日志缩略名\" class=\"headerlink\" title=\"9. PHP创建日志缩略名\"></a>9. PHP创建日志缩略名</h3><p>创建用户友好的日志缩略名。</p>\n<pre><code>function create_slug($string)&#123;\n    $slug=preg_replace(&#39;/[^A-Za-z0-9-]+/&#39;, &#39;-&#39;, $string);\n    return $slug;\n&#125;\n</code></pre><h3 id=\"10-PHP获取客户端真实-IP-地址\"><a href=\"#10-PHP获取客户端真实-IP-地址\" class=\"headerlink\" title=\"10. PHP获取客户端真实 IP 地址\"></a>10. PHP获取客户端真实 IP 地址</h3><p>该函数将获取用户的真实 IP 地址，即便他使用代理服务器。</p>\n<pre><code>function getRealIpAddr()\n&#123;\n    if (!emptyempty($_SERVER[&#39;HTTP_CLIENT_IP&#39;]))\n    &#123;\n        $ip=$_SERVER[&#39;HTTP_CLIENT_IP&#39;];\n    &#125;\n    elseif (!emptyempty($_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;]))\n    //to check ip is pass from proxy\n    &#123;\n        $ip=$_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;];\n    &#125;\n    else\n    &#123;\n        $ip=$_SERVER[&#39;REMOTE_ADDR&#39;];\n    &#125;\n    return $ip;\n&#125;\n</code></pre><h3 id=\"11-PHP强制性文件下载\"><a href=\"#11-PHP强制性文件下载\" class=\"headerlink\" title=\"11. PHP强制性文件下载\"></a>11. PHP强制性文件下载</h3><p>为用户提供强制性的文件下载功能。</p>\n<pre><code>/********************\n*@file - path to file\n*/\nfunction force_download($file)\n&#123;\n    if ((isset($file))&amp;&amp;(file_exists($file))) &#123;\n       header(&quot;Content-length: &quot;.filesize($file));\n       header(&#39;Content-Type: application/octet-stream&#39;);\n       header(&#39;Content-Disposition: attachment; filename=&quot;&#39; . $file . &#39;&quot;&#39;);\n       readfile(&quot;$file&quot;);\n    &#125; else &#123;\n       echo &quot;No file selected&quot;;\n    &#125;\n&#125;\n</code></pre><h3 id=\"12-PHP创建标签云\"><a href=\"#12-PHP创建标签云\" class=\"headerlink\" title=\"12. PHP创建标签云\"></a>12. PHP创建标签云</h3><pre><code>function getCloud( $data = array(), $minFontSize = 12, $maxFontSize = 30 )\n&#123;\n    $minimumCount = min( array_values( $data ) );\n    $maximumCount = max( array_values( $data ) );\n    $spread       = $maximumCount - $minimumCount;\n    $cloudHTML    = &#39;&#39;;\n    $cloudTags    = array();  \n\n    $spread == 0 &amp;&amp; $spread = 1;  \n\n    foreach( $data as $tag =&gt; $count )\n    &#123;\n        $size = $minFontSize + ( $count - $minimumCount )\n            * ( $maxFontSize - $minFontSize ) / $spread;\n        $cloudTags[] = &#39;&lt;a style=&quot;font-size: &#39; . floor( $size ) . &#39;px&#39;\n        . &#39;&quot; href=&quot;#&quot; title=&quot;\\&#39;&#39; . $tag  .\n        &#39;\\&#39; returned a count of &#39; . $count . &#39;&quot;&gt;&#39;\n        . htmlspecialchars( stripslashes( $tag ) ) . &#39;&lt;/a&gt;&#39;;\n    &#125;  \n\n    return join( &quot;\\n&quot;, $cloudTags ) . &quot;\\n&quot;;\n&#125;\n/**************************\n****   Sample usage    ***/\n$arr = Array(&#39;Actionscript&#39; =&gt; 35, &#39;Adobe&#39; =&gt; 22, &#39;Array&#39; =&gt; 44, &#39;Background&#39; =&gt; 43,\n    &#39;Blur&#39; =&gt; 18, &#39;Canvas&#39; =&gt; 33, &#39;Class&#39; =&gt; 15, &#39;Color Palette&#39; =&gt; 11, &#39;Crop&#39; =&gt; 42,\n    &#39;Delimiter&#39; =&gt; 13, &#39;Depth&#39; =&gt; 34, &#39;Design&#39; =&gt; 8, &#39;Encode&#39; =&gt; 12, &#39;Encryption&#39; =&gt; 30,\n    &#39;Extract&#39; =&gt; 28, &#39;Filters&#39; =&gt; 42);\necho getCloud($arr, 12, 36);\n</code></pre><h3 id=\"13-PHP寻找两个字符串的相似性\"><a href=\"#13-PHP寻找两个字符串的相似性\" class=\"headerlink\" title=\"13. PHP寻找两个字符串的相似性\"></a>13. PHP寻找两个字符串的相似性</h3><p>PHP 提供了一个极少使用的 similar_text 函数，但此函数非常有用，用于比较两个字符串并返回相似程度的百分比。</p>\n<pre><code>similar_text($string1, $string2, $percent);\n//$percent will have the percentage of similarity\n</code></pre><h3 id=\"14-PHP在应用程序中使用-Gravatar-通用头像\"><a href=\"#14-PHP在应用程序中使用-Gravatar-通用头像\" class=\"headerlink\" title=\"14. PHP在应用程序中使用 Gravatar 通用头像\"></a>14. PHP在应用程序中使用 Gravatar 通用头像</h3><p>随着 WordPress 越来越普及，Gravatar 也随之流行。由于 Gravatar 提供了易于使用的 API，将其纳入应用程序也变得十分方便。</p>\n<pre><code>/******************\n*@email - Email address to show gravatar for\n*@size - size of gravatar\n*@default - URL of default gravatar to use\n*@rating - rating of Gravatar(G, PG, R, X)\n*/\nfunction show_gravatar($email, $size, $default, $rating)\n&#123;\n    echo &#39;&lt;img src=&quot;http://www.gravatar.com/avatar.php?gravatar_id=&#39;.md5($email).\n        &#39;&amp;default=&#39;.$default.&#39;&amp;size=&#39;.$size.&#39;&amp;rating=&#39;.$rating.&#39;&quot; width=&quot;&#39;.$size.&#39;px&quot;\n        height=&quot;&#39;.$size.&#39;px&quot; /&gt;&#39;;\n&#125;\n</code></pre><h3 id=\"15-PHP在字符断点处截断文字\"><a href=\"#15-PHP在字符断点处截断文字\" class=\"headerlink\" title=\"15. PHP在字符断点处截断文字\"></a>15. PHP在字符断点处截断文字</h3><p>所谓断字 (word break)，即一个单词可在转行时断开的地方。这一函数将在断字处截断字符串。</p>\n<pre><code>// Original PHP code by Chirp Internet: www.chirp.com.au\n// Please acknowledge use of this code by including this header.\nfunction myTruncate($string, $limit, $break=&quot;.&quot;, $pad=&quot;...&quot;) &#123;\n    // return with no change if string is shorter than $limit\n    if(strlen($string) &lt;= $limit)\n        return $string;   \n\n    // is $break present between $limit and the end of the string?\n    if(false !== ($breakpoint = strpos($string, $break, $limit))) &#123;\n        if($breakpoint &lt; strlen($string) - 1) &#123;\n            $string = substr($string, 0, $breakpoint) . $pad;\n        &#125;\n    &#125;\n    return $string;\n&#125;\n/***** Example ****/\n$short_string=myTruncate($long_string, 100, &#39; &#39;);\n</code></pre><h3 id=\"16-PHP文件-Zip-压缩\"><a href=\"#16-PHP文件-Zip-压缩\" class=\"headerlink\" title=\"16. PHP文件 Zip 压缩\"></a>16. PHP文件 Zip 压缩</h3><pre><code>/* creates a compressed zip file */\nfunction create_zip($files = array(),$destination = &#39;&#39;,$overwrite = false) &#123;\n    //if the zip file already exists and overwrite is false, return false\n    if(file_exists($destination) &amp;&amp; !$overwrite) &#123; return false; &#125;\n    //vars\n    $valid_files = array();\n    //if files were passed in...\n    if(is_array($files)) &#123;\n        //cycle through each file\n        foreach($files as $file) &#123;\n            //make sure the file exists\n            if(file_exists($file)) &#123;\n                $valid_files[] = $file;\n            &#125;\n        &#125;\n    &#125;\n    //if we have good files...\n    if(count($valid_files)) &#123;\n        //create the archive\n        $zip = new ZipArchive();\n        if($zip-&gt;open($destination,$overwrite ? ZIPARCHIVE::OVERWRITE : ZIPARCHIVE::CREATE) !== true) &#123;\n            return false;\n        &#125;\n        //add the files\n        foreach($valid_files as $file) &#123;\n            $zip-&gt;addFile($file,$file);\n        &#125;\n        //debug\n        //echo &#39;The zip archive contains &#39;,$zip-&gt;numFiles,&#39; files with a status of &#39;,$zip-&gt;status;  \n\n        //close the zip -- done!\n        $zip-&gt;close();  \n\n        //check to make sure the file exists\n        return file_exists($destination);\n    &#125;\n    else\n    &#123;\n        return false;\n    &#125;\n&#125;\n/***** Example Usage ***/\n$files=array(&#39;file1.jpg&#39;, &#39;file2.jpg&#39;, &#39;file3.gif&#39;);\ncreate_zip($files, &#39;myzipfile.zip&#39;, true);\n</code></pre><h3 id=\"17-PHP解压缩-Zip-文件\"><a href=\"#17-PHP解压缩-Zip-文件\" class=\"headerlink\" title=\"17. PHP解压缩 Zip 文件\"></a>17. PHP解压缩 Zip 文件</h3><pre><code>/**********************\n*@file - path to zip file\n*@destination - destination directory for unzipped files\n*/\nfunction unzip_file($file, $destination)&#123;\n    // create object\n    $zip = new ZipArchive() ;\n    // open archive\n    if ($zip-&gt;open($file) !== TRUE) &#123;\n        die (’Could not open archive’);\n    &#125;\n    // extract contents to destination directory\n    $zip-&gt;extractTo($destination);\n    // close archive\n    $zip-&gt;close();\n    echo &#39;Archive extracted to directory&#39;;\n&#125;\n</code></pre><h3 id=\"18-PHP为-URL-地址预设-http-字符串\"><a href=\"#18-PHP为-URL-地址预设-http-字符串\" class=\"headerlink\" title=\"18. PHP为 URL 地址预设 http 字符串\"></a>18. PHP为 URL 地址预设 http 字符串</h3><p>有时需要接受一些表单中的网址输入，但用户很少添加 http:// 字段，此代码将为网址添加该字段。</p>\n<pre><code>if (!preg_match(&quot;/^(http|ftp):/&quot;, $_POST[&#39;url&#39;])) &#123;\n   $_POST[&#39;url&#39;] = &#39;http://&#39;.$_POST[&#39;url&#39;];\n&#125;\n</code></pre><h3 id=\"19-PHP将网址字符串转换成超级链接\"><a href=\"#19-PHP将网址字符串转换成超级链接\" class=\"headerlink\" title=\"19. PHP将网址字符串转换成超级链接\"></a>19. PHP将网址字符串转换成超级链接</h3><p>该函数将 URL 和 E-mail 地址字符串转换为可点击的超级链接。</p>\n<pre><code>function makeClickableLinks($text) &#123;\n $text = eregi_replace(&#39;(((f|ht)&#123;1&#125;tp://)[-a-zA-Z0-9@:%_+.~#?&amp;//=]+)&#39;,\n &#39;&lt;a href=&quot;\\1&quot;&gt;\\1&lt;/a&gt;&#39;, $text);\n $text = eregi_replace(&#39;([[:space:]()[&#123;&#125;])(www.[-a-zA-Z0-9@:%_+.~#?&amp;//=]+)&#39;,\n &#39;\\1&lt;a href=&quot;http://\\2&quot;&gt;\\2&lt;/a&gt;&#39;, $text);\n $text = eregi_replace(&#39;([_.0-9a-z-]+@([0-9a-z][0-9a-z-]+.)+[a-z]&#123;2,3&#125;)&#39;,\n &#39;&lt;a href=&quot;mailto:\\1&quot;&gt;\\1&lt;/a&gt;&#39;, $text);  \n\nreturn $text;\n&#125;\n</code></pre><h3 id=\"20-PHP调整图像尺寸\"><a href=\"#20-PHP调整图像尺寸\" class=\"headerlink\" title=\"20. PHP调整图像尺寸\"></a>20. PHP调整图像尺寸</h3><p>创建图像缩略图需要许多时间，此代码将有助于了解缩略图的逻辑。</p>\n<pre><code>/**********************\n*@filename - path to the image\n*@tmpname - temporary path to thumbnail\n*@xmax - max width\n*@ymax - max height\n*/\nfunction resize_image($filename, $tmpname, $xmax, $ymax)\n&#123;\n    $ext = explode(&quot;.&quot;, $filename);\n    $ext = $ext[count($ext)-1];  \n\n    if($ext == &quot;jpg&quot; || $ext == &quot;jpeg&quot;)\n        $im = imagecreatefromjpeg($tmpname);\n    elseif($ext == &quot;png&quot;)\n        $im = imagecreatefrompng($tmpname);\n    elseif($ext == &quot;gif&quot;)\n        $im = imagecreatefromgif($tmpname);  \n\n    $x = imagesx($im);\n    $y = imagesy($im);  \n\n    if($x &lt;= $xmax &amp;&amp; $y &lt;= $ymax)\n        return $im;  \n\n    if($x &gt;= $y) &#123;\n        $newx = $xmax;\n        $newy = $newx * $y / $x;\n    &#125;\n    else &#123;\n        $newy = $ymax;\n        $newx = $x / $y * $newy;\n    &#125;  \n\n    $im2 = imagecreatetruecolor($newx, $newy);\n    imagecopyresized($im2, $im, 0, 0, 0, 0, floor($newx), floor($newy), $x, $y);\n    return $im2;\n&#125;\n</code></pre><h3 id=\"21-PHP检测-Ajax-请求\"><a href=\"#21-PHP检测-Ajax-请求\" class=\"headerlink\" title=\"21. PHP检测 Ajax 请求\"></a>21. PHP检测 Ajax 请求</h3><p>大多数的 JavaScript 框架如 jQuery，Mootools 等，在发出 Ajax 请求时，都会发送额外的 HTTP_X_REQUESTED_WITH 头部信息，头当他们一个ajax请求，因此你可以在服务器端侦测到 Ajax 请求。</p>\n<pre><code>if(!emptyempty($_SERVER[&#39;HTTP_X_REQUESTED_WITH&#39;]) &amp;&amp; strtolower($_SERVER[&#39;HTTP_X_REQUESTED_WITH&#39;]) == &#39;xmlhttprequest&#39;)&#123;\n    //If AJAX Request Then\n&#125;else&#123;\n//something else\n&#125;\n</code></pre>",
            "tags": [
                "php",
                "php服务器",
                "随笔",
                "php实例"
            ]
        },
        {
            "id": "https://erik.xyz/2014/12/25/php-unserialize-an-quan-lou-dong/",
            "url": "https://erik.xyz/2014/12/25/php-unserialize-an-quan-lou-dong/",
            "title": "PHP “Unserialize()”安全漏洞",
            "date_published": "2014-12-25T02:27:00.000Z",
            "content_html": "<p>来源：Linux社区  作者：Linux 受影响系统： PHP PHP &lt; 5.4.36 描述： CVE(CAN) ID: CVE-2014-8142 PHP是广泛使用的通用目的脚本语言，特别适合于Web开发，可嵌入到HTML中。 PHP 5.4.36之前版本，”process_nested_data()”函数在实现上存在释放后重利用漏洞，攻击者通过向”unserialize()” 函数传递构造的输入，利用此漏洞可破坏内存；”var_push_dtor()”函数在实现上存在空指针间接引用漏洞，攻击者通过 向”unserialize()”函数传递构造的输入，利用此漏洞可造成崩溃。成功利用这些漏洞可造成任意代码执行。 &lt;<em>来源：Stefan Esser 链接：<a href=\"http://secunia.com/advisories/61236/\">http://secunia.com/advisories/61236/</a> </em>> 建议： 厂商补丁： PHP —- 目前厂商已经发布了升级补丁以修复这个安全问题，请到厂商的主页下载： PHP: <a href=\"http://php.net/ChangeLog-5.php#5.4.36\">http://php.net/ChangeLog-5.php#5.4.36</a> <a href=\"https://bugs.php.net/bug.php?id=68594\">https://bugs.php.net/bug.php?id=68594</a> Charlie Eriksen: <a href=\"https://bugs.php.net/bug.php?id=68545\">https://bugs.php.net/bug.php?id=68545</a> <a href=\"http://www.linuxidc.com/topicnews.aspx?tid=14\" title=\"CentOS\">CentOS</a> 6.3 安装LNMP (PHP 5.4,MyySQL5.6) <a href=\"http://www.linuxidc.com/Linux/2013-04/82069.htm\">http://www.linuxidc.com/Linux/2013-04/82069.htm</a> 在部署LNMP的时候遇到Nginx启动失败的2个问题 <a href=\"http://www.linuxidc.com/Linux/2013-03/81120.htm\">http://www.linuxidc.com/Linux/2013-03/81120.htm</a> <a href=\"http://www.linuxidc.com/topicnews.aspx?tid=2\" title=\"Ubuntu\">Ubuntu</a>安装Nginx php5-fpm MySQL(LNMP环境搭建) <a href=\"http://www.linuxidc.com/Linux/2012-10/72458.htm\">http://www.linuxidc.com/Linux/2012-10/72458.htm</a></p>\n",
            "tags": [
                "php",
                "php服务器",
                "漏洞"
            ]
        },
        {
            "id": "https://erik.xyz/2014/12/22/wei-mysql-she-zhi-cha-xun-chao-shi/",
            "url": "https://erik.xyz/2014/12/22/wei-mysql-she-zhi-cha-xun-chao-shi/",
            "title": "为MySQL设置查询超时",
            "date_published": "2014-12-22T13:03:00.000Z",
            "content_html": "<p>作者: <a href=\"http://www.laruence.com\">Laruence</a> 昨天有人在群里问, MySQL是否可以设置读写超时(非连接超时), 如果可以就可以避免一条SQL执行过慢, 导致PHP超时错误. 这个, 其实可以有. 只不过稍微要麻烦点. 首先, 在libmysql中, 是提供了MYSQL_OPT_READ_TIMEOUT设置项的, 并且libmysql中提供了设置相关设置项的API, mysql_options:<span id=\"more\"></span></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int STDCALL</span><br><span class=\"line\">  mysql_options(MYSQL *mysql,enum mysql_option option, const void *arg)</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    DBUG_ENTER(&quot;mysql_option&quot;);</span><br><span class=\"line\">    DBUG_PRINT(&quot;enter&quot;,(&quot;option: %d&quot;,(int) option));</span><br><span class=\"line\">    switch (option) &#123;</span><br><span class=\"line\">    case MYSQL\\_OPT\\_CONNECT_TIMEOUT:</span><br><span class=\"line\">      mysql-&gt;options.connect_timeout= *(uint*) arg;</span><br><span class=\"line\">      break;</span><br><span class=\"line\">    /\\*\\* 读超时时间 */</span><br><span class=\"line\">   case MYSQL\\_OPT\\_READ_TIMEOUT:</span><br><span class=\"line\">      mysql-&gt;options.read_timeout= *(uint*) arg;</span><br><span class=\"line\">      break;</span><br><span class=\"line\">    case MYSQL\\_OPT\\_WRITE_TIMEOUT:</span><br><span class=\"line\">      mysql-&gt;options.write_timeout= *(uint*) arg;</span><br><span class=\"line\">      break;</span><br><span class=\"line\">    case MYSQL\\_OPT\\_COMPRESS:</span><br><span class=\"line\">      mysql-&gt;options.compress= 1;</span><br><span class=\"line\"></span><br><span class=\"line\">     /\\* 以下省略 */</span><br></pre></td></tr></table></figure>\n<p>但是, 可惜的是, 目前只有mysqli扩展, 把mysql_options完全暴露给了PHP:<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PHP_FUNCTION(mysqli_options)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"> /\\*\\* 有省略 */</span><br><span class=\"line\">     switch (Z\\_TYPE\\_PP(mysql_value)) &#123;</span><br><span class=\"line\">        /\\*\\* 没有任何限制, 直接传递给mysql_options */</span><br><span class=\"line\">        case IS_STRING:</span><br><span class=\"line\">            ret = mysql_options(mysql-&gt;mysql, mysql_option, Z\\_STRVAL\\_PP(mysql_value));</span><br><span class=\"line\">            break;</span><br><span class=\"line\">         default:</span><br><span class=\"line\">            convert\\_to\\_long_ex(mysql_value);</span><br><span class=\"line\">             l_value = Z\\_LVAL\\_PP(mysql_value);</span><br><span class=\"line\">            ret = mysql_options(mysql-&gt;mysql, mysql_option, (char *)&amp;l_value);</span><br><span class=\"line\">            break;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    RETURN_BOOL(!ret);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br>但是因为Mysqli并没有导出这个常量, 所以我们需要通过查看MySQL的代码, 得到MYSQL_OPT_READ_TIMEOUT的实际值, 然后直接调用mysql_options:<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">enum mysql_option</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  MYSQL\\_OPT\\_CONNECT_TIMEOUT, MYSQL\\_OPT\\_COMPRESS, MYSQL\\_OPT\\_NAMED_PIPE,</span><br><span class=\"line\">  MYSQL\\_INIT\\_COMMAND, MYSQL\\_READ\\_DEFAULT_FILE, MYSQL\\_READ\\_DEFAULT_GROUP,</span><br><span class=\"line\">  MYSQL\\_SET\\_CHARSET_DIR, MYSQL\\_SET\\_CHARSET_NAME, MYSQL\\_OPT\\_LOCAL_INFILE,</span><br><span class=\"line\">   MYSQL\\_OPT\\_PROTOCOL, MYSQL\\_SHARED\\_MEMORY\\_BASE\\_NAME, MYSQL\\_OPT\\_READ_TIMEOUT,</span><br><span class=\"line\">  MYSQL\\_OPT\\_WRITE_TIMEOUT, MYSQL\\_OPT\\_USE_RESULT,</span><br><span class=\"line\">  MYSQL\\_OPT\\_USE\\_REMOTE\\_CONNECTION, MYSQL\\_OPT\\_USE\\_EMBEDDED\\_CONNECTION,</span><br><span class=\"line\">  MYSQL\\_OPT\\_GUESS_CONNECTION, MYSQL\\_SET\\_CLIENT_IP, MYSQL\\_SECURE\\_AUTH,</span><br><span class=\"line\">  MYSQL\\_REPORT\\_DATA_TRUNCATION, MYSQL\\_OPT\\_RECONNECT,</span><br><span class=\"line\">  MYSQL\\_OPT\\_SSL\\_VERIFY\\_SERVER_CERT</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure><br>可以看到, MYSQL_OPT_READ_TIMEOUT为11. 现在, 我们就可以设置查询超时了:<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">$mysqli = mysqli_init();</span><br><span class=\"line\">$mysqli-&gt;options(11 /\\*MYSQL\\_OPT\\_READ_TIMEOUT\\*/, 1);</span><br><span class=\"line\">$mysql-&gt;real_connect(***);</span><br></pre></td></tr></table></figure><br>不过, 因为在libmysql中有重试机制(尝试一次, 重试俩次), 所以, 最终我们设置的超时阈值都会三倍于我们设置的值. 也就是说, 如果我们设置了MYSQL_OPT_READ_TIMEOUT为1, 最终会在3s以后超时结束. 也就是说, 我们目前能设置的最短超时时, 就是3秒… 虽说大了点,, 不过总比没有好, 呵呵 PS: 写了一半的时候, 就发现小黑已经写过一篇了, 所以大家也可以参看这篇<a href=\"http://blog.csdn.net/heiyeshuwu/archive/2010/09/08/5869813.aspx\">PHP访问MySQL查询超时处理</a></p>\n",
            "tags": [
                "php服务器",
                "centos6.5",
                "mysql",
                "mysql设置超时，超时"
            ]
        },
        {
            "id": "https://erik.xyz/2014/12/20/nginx-1-5-2-php-5-5-1-mysql-5-6-10-zai-centos-xia-de-bian-yi-an-zhuang/",
            "url": "https://erik.xyz/2014/12/20/nginx-1-5-2-php-5-5-1-mysql-5-6-10-zai-centos-xia-de-bian-yi-an-zhuang/",
            "title": "Nginx 1.5.2 + PHP 5.5.1 + MySQL 5.6.10 在 CentOS 下的编译安装",
            "date_published": "2014-12-20T11:58:00.000Z",
            "content_html": "<p>by <a href=\"http://zyan.cc/user/2/\">张宴</a> ]</p>\n<p>　　最近配置了几台Web服务器，将安装笔记贴出来吧。没时间像以前那样，将文章写的那样系统了，请见谅。详细配置，可以看以前的旧文章：<a href=\"http://blog.zyan.cc/nginx_php_v6\">http://blog.zyan.cc/nginx_php_v6</a> 1、安装Nginx：<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p /Data/tgz cd /Data/tgz yum install wget yum install pcre yum install openssl* yum -y install gcc gcc-c++ autoconf libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel libxml2 libxml2-devel zlib zlib-devel glibc glibc-devel glib2 glib2-devel bzip2 bzip2-devel ncurses ncurses-devel curl curl-devel e2fsprogs e2fsprogs-devel krb5 krb5-devel libidn libidn-devel openssl openssl-devel openldap openldap-devel nss_ldap openldap-clients openldap-servers make yum -y install gd gd2 gd-devel gd2-devel /usr/sbin/groupadd www /usr/sbin/useradd -g www www ulimit -SHn 65535 wget [ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.32.tar.gz](ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.32.tar.gz) tar zxvf pcre-8.32.tar.gz cd pcre-8.32 ./configure --prefix=/Data/apps/pcre make &amp;&amp; make install cd ../wget [http://nginx.org/download/nginx-1.5.2.tar.gz](http://nginx.org/download/nginx-1.5.2.tar.gz) tar zxvf nginx-1.5.2.tar.gz cd nginx-1.5.2 ./configure --user=www --group=www --prefix=/Data/apps/nginx --with-http\\_stub\\_status\\_module --with-http\\_ssl\\_module --with-pcre=/Data/tgz/pcre-8.32 --with-http\\_realip\\_module --with-http\\_image\\_filter\\_module make make install cd ../</span><br></pre></td></tr></table></figure><br><span id=\"more\"></span><br>2、安装 MySQL：<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget [http://downloads.mysql.com/archives/mysql-5.6/mysql-5.6.10-linux-glibc2.5-x86_64.tar.gz](http://downloads.mysql.com/archives/mysql-5.6/mysql-5.6.10-linux-glibc2.5-x86_64.tar.gz) tar zxvf mysql-5.6.10-linux-glibc2.5-x86\\_64.tar.gz mv mysql-5.6.10-linux-glibc2.5-x86\\_64 /Data/apps/mysql /usr/sbin/groupadd mysql /usr/sbin/useradd -g mysql mysql mkdir -p /Data/data/mysql/data yum install libaio /Data/apps/mysql/scripts/mysql\\_install\\_db --basedir=/Data/apps/mysql --datadir=/Data/data/mysql/data --user=mysqlsed -i &quot;s#/usr/local/mysql#/Data/apps/mysql#g&quot; /Data/apps/mysql/bin/mysqld_safe</span><br></pre></td></tr></table></figure><br>3、安装PHP依赖库<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p /Data/apps/libs/ wget [http://www.ijg.org/files/jpegsrc.v9.tar.gz    ](http://www.ijg.org/files/jpegsrc.v9.tar.gz%C2%A0%C2%A0%C2%A0%C2%A0) tar zxvf jpegsrc.v9.tar.gz cd jpeg-9/ ./configure --prefix=/Data/apps/libs --enable-shared --enable-static --prefix=/Data/apps/libs make make install cd ../wget [http://prdownloads.sourceforge.net/libpng/libpng-1.6.2.tar.gz](http://prdownloads.sourceforge.net/libpng/libpng-1.6.2.tar.gz) tar zxvf libpng-1.6.2.tar.gz cd libpng-1.6.2/ ./configure --prefix=/Data/apps/libs make make install cd ../wget [http://download.savannah.gnu.org/releases/freetype/freetype-2.4.12.tar.gz](http://download.savannah.gnu.org/releases/freetype/freetype-2.4.12.tar.gz) tar zxvf freetype-2.4.12.tar.gz cd freetype-2.4.12/ ./configure --prefix=/Data/apps/libs make make install cd ../ wget &quot;http://downloads.sourceforge.net/mhash/mhash-0.9.9.9.tar.gz?big\\_mirror=0&quot; wget &quot;http://downloads.sourceforge.net/mcrypt/libmcrypt-2.5.8.tar.gz?big\\_mirror=0&quot; wget &quot;http://downloads.sourceforge.net/mcrypt/mcrypt-2.6.8.tar.gz?big_mirror=0&quot; tar zxvf libmcrypt-2.5.8.tar.gz cd libmcrypt-2.5.8/ ./configure --prefix=/Data/apps/libs make make install cd libltdl/ ./configure --prefix=/Data/apps/libs --enable-ltdl-install make make install cd ../../ tar zxvf mhash-0.9.9.9.tar.gz cd mhash-0.9.9.9/ ./configure --prefix=/Data/apps/libs make make install cd ../</span><br><span class=\"line\"></span><br><span class=\"line\">vi /etc/ld.so.conf</span><br></pre></td></tr></table></figure><br>添加：<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/Data/apps/libs/lib</span><br></pre></td></tr></table></figure><br>然后：<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ldconfig</span><br><span class=\"line\"></span><br><span class=\"line\">tar zxvf mcrypt-2.6.8.tar.gz cd mcrypt-2.6.8/ export LDFLAGS=&quot;-L/Data/apps/libs/lib -L/usr/lib&quot; export CFLAGS=&quot;-I/Data/apps/libs/include -I/usr/include&quot; touch malloc.h ./configure --prefix=/Data/apps/libs --with-libmcrypt-prefix=/Data/apps/libs make make install cd ../</span><br></pre></td></tr></table></figure><br>4、编译安装PHP 5.5<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget [http://www.php.net/get/php-5.5.1.tar.gz/from/tw2.php.net/mirror](http://www.php.net/get/php-5.5.1.tar.gz/from/tw2.php.net/mirror) tar zxvf php-5.5.1.tar.gz cd php-5.5.1/ export LIBS=&quot;-lm -ltermcap -lresolv&quot; export DYLD\\_LIBRARY\\_PATH=&quot;/Data/apps/mysql/lib/:/lib/:/usr/lib/:/usr/local/lib:/lib64/:/usr/lib64/:/usr/local/lib64&quot; export LD\\_LIBRARY\\_PATH=&quot;/Data/apps/mysql/lib/:/lib/:/usr/lib/:/usr/local/lib:/lib64/:/usr/lib64/:/usr/local/lib64&quot; ./configure --prefix=/Data/apps/php --with-config-file-path=/Data/apps/php/etc --with-mysql=/Data/apps/mysql --with-mysqli=/Data/apps/mysql/bin/mysql_config --with-iconv-dir --with-freetype-dir=/Data/apps/libs --with-jpeg-dir=/Data/apps/libs --with-png-dir=/Data/apps/libs --with-zlib --with-libxml-dir=/usr --enable-xml --disable-rpath --enable-bcmath --enable-shmop --enable-sysvsem --enable-inline-optimization --with-curl --enable-mbregex --enable-fpm --enable-mbstring --with-mcrypt=/Data/apps/libs --with-gd --enable-gd-native-ttf --with-openssl --with-mhash --enable-pcntl --enable-sockets --with-xmlrpc --enable-zip --enable-soap --enable-opcache --with-pdo-mysql --enable-maintainer-zts make make install cp php.ini-development /Data/apps/php/etc/php.ini cd ../ln -s /Data/apps/mysql/lib/libmysqlclient.18.dylib /usr/lib/libmysqlclient.18.dylib mv /Data/apps/php/etc/php-fpm.conf.default /Data/apps/php/etc/php-fpm.conf</span><br></pre></td></tr></table></figure><br>5、编译安装PHP扩展<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget [http://ftp.gnu.org/gnu/autoconf/autoconf-latest.tar.gz](http://ftp.gnu.org/gnu/autoconf/autoconf-latest.tar.gz) tar zxvf autoconf-latest.tar.gz cd autoconf-2.69/ ./configure --prefix=/Data/apps/libs make make install cd ../wget [http://pecl.php.net/get/memcache-2.2.7.tgz](http://pecl.php.net/get/memcache-2.2.7.tgz) tar zxvf memcache-2.2.7.tgz cd memcache-2.2.7/ export PHP\\_AUTOCONF=&quot;/Data/apps/libs/bin/autoconf&quot; export PHP\\_AUTOHEADER=&quot;/Data/apps/libs/bin/autoheader&quot; /Data/apps/php/bin/phpize ./configure --with-php-config=/Data/apps/php/bin/php-config make make install cd ../</span><br></pre></td></tr></table></figure><br>打开 /Data/apps/php/etc/php.ini 查找 ; extension_dir = “ext” 在其后增加一行：</p>\n<p>extension = “memcache.so”</p>\n",
            "tags": [
                "php",
                "web",
                "php服务器"
            ]
        },
        {
            "id": "https://erik.xyz/2014/12/19/shang-chuan-jin-du-zhi-chi-upload-progress-in-sessions/",
            "url": "https://erik.xyz/2014/12/19/shang-chuan-jin-du-zhi-chi-upload-progress-in-sessions/",
            "title": "上传进度支持(Upload progress in sessions)",
            "date_published": "2014-12-19T13:08:00.000Z",
            "content_html": "<ul>\n<li>作者: <a href=\"http://www.laruence.com\">Laruence</a></li>\n</ul>\n<p>文件上传进度反馈, 这个需求在当前是越来越普遍, 比如大附件邮件. 在PHP5.4以前, 我们可以通过<a href=\"http://www.php.net/manual/zh/apc.configuration.php#ini.apc.rfc1867\">APC</a>提供的功能来实现. 或者使用PECL扩展<a href=\"http://pecl.php.net/package/uploadprogress\">uploadprogress</a>来实现. 虽然说, 它们能很好的解决现在的问题, 但是也有很明显的不足:</p>\n<ul>\n<li>1. 他们都需要额外安装(我们并没有打算把APC加入PHP5.4)</li>\n<li><p>2. 它们都使用本地机制来存储这些信息, APC使用共享内存, 而uploadprogress使用文件系统(不考虑NFS), 这在多台前端机的时候会造成麻烦.</p>\n<span id=\"more\"></span>\n<p>从PHP的角度来说, 最好的储存这些信息的地方应该是SESSION, 首先它是PHP原生支持的机制. 其次, 它可以被配置到存放到任何地方(支持多机共享). 正因为此, Arnaud Le Blanc提出了针对Session报告上传进度的<a href=\"http://wiki.php.net/rfc/session_upload_progress\">RFC</a>, 并且现在实现也已经包含在了PHP5.4的主干中. 这个新特性, 提供了一些新的INI配置, 他们和APC的相关配置很类似:</p>\n</li>\n<li><p>session.upload_progress.enabled[=1] : 是否启用上传进度报告(默认开启)</p>\n</li>\n<li>session.upload_progress.cleanup[=1] : 是否在上传完成后及时删除进度数据(默认开启, 推荐开启).</li>\n<li>session.upload_progress.prefix[=upload_progress_] : 进度数据将存储在_SESSION[session.upload_progress.prefix . _POST[session.upload_progress.name]]</li>\n<li>session.upload_progress.name[=PHP_SESSION_UPLOAD_PROGRESS] : 如果_POST[session.upload_progress.name]没有被设置, 则不会报告进度.</li>\n<li>session.upload_progress.freq[=1%] : 更新进度的频率(已经处理的字节数), 也支持百分比表示’%’.</li>\n<li>session.upload_progress.min_freq[=1.0] : 更新进度的时间间隔(秒级)</li>\n</ul>\n<p>对于如下的上传表单:</p>\n<pre><code>&lt;form action=&quot;upload.php&quot; method=&quot;POST&quot; enctype=&quot;multipart/form-data&quot;&gt;\n &lt;input type=&quot;hidden&quot;\n     name=&quot;&lt;?php echo ini_get(&quot;session.upload_progress.name&quot;); ?&gt;&quot; value=&quot;laruence&quot; /&gt;\n &lt;input type=&quot;file&quot; name=&quot;file1&quot; /&gt;\n &lt;input type=&quot;file&quot; name=&quot;file2&quot; /&gt;\n &lt;input type=&quot;submit&quot; /&gt;\n&lt;/form&gt;\n</code></pre><p>如果我们上传一个足够大的文件(网速要是足够慢就更好:P), 我们就可以从_SESSION中, 得到类似下面的进度信息:</p>\n<pre><code> $_SESSION\\[&quot;upload\\_progress\\_laruence&quot;\\] = array(\n  &quot;start_time&quot; =&gt; 1234567890, // 请求时间\n  &quot;content_length&quot; =&gt; 57343257, // 上传文件总大小\n  &quot;bytes_processed&quot; =&gt; 453489, // 已经处理的大小\n  &quot;done&quot; =&gt; false, // 当所有上传处理完成后为TRUE\n  &quot;files&quot; =&gt; array(\n   0 =&gt; array(\n    &quot;field_name&quot; =&gt; &quot;file1&quot;, // 表单中上传框的名字\n    // The following 3 elements equals those in $_FILES\n     &quot;name&quot; =&gt; &quot;foo.avi&quot;,\n     &quot;tmp_name&quot; =&gt; &quot;/tmp/phpxxxxxx&quot;,\n     &quot;error&quot; =&gt; 0,\n     &quot;done&quot; =&gt; true, // 当这个文件处理完成后会变成TRUE\n     &quot;start_time&quot; =&gt; 1234567890, // 这个文件开始处理时间\n     &quot;bytes_processed&quot; =&gt; 57343250, // 这个文件已经处理的大小\n    ),\n    // An other file, not finished uploading, in the same request\n    1 =&gt; array(\n     &quot;field_name&quot; =&gt; &quot;file2&quot;,\n     &quot;name&quot; =&gt; &quot;bar.avi&quot;,\n     &quot;tmp_name&quot; =&gt; NULL,\n     &quot;error&quot; =&gt; 0,\n     &quot;done&quot; =&gt; false,\n     &quot;start_time&quot; =&gt; 1234567899,\n     &quot;bytes_processed&quot; =&gt; 54554,\n    ),\n   )\n  );\n</code></pre><p>这个是不是很方便呢? 但是还是要提醒一下, PHP 5.4还处于开发阶段, 在最终release之前, 任何新特性都可能被调整或者更改. 如果大家有任何建议, 也欢迎反馈, 帮助我们使得PHP变得更好. 谢谢</p>\n",
            "tags": [
                "php",
                "php服务器",
                "php函数"
            ]
        },
        {
            "id": "https://erik.xyz/2014/12/18/zai-yi-ci-bu-yao-shi-yong-include-require-once/",
            "url": "https://erik.xyz/2014/12/18/zai-yi-ci-bu-yao-shi-yong-include-require-once/",
            "title": "再一次, 不要使用(include/require)_once",
            "date_published": "2014-12-18T13:50:00.000Z",
            "content_html": "<ul>\n<li>作者: <a href=\"http://www.laruence.com\">Laruence</a></li>\n</ul>\n<p>最近关于apc.include_once_override的去留, 我们做了几次讨论, 这个APC的配置项一直一来就没有被很好的实现过. 在这里, 我想和大家在此分享下, 这个问题的原因, 以及对我们的一些启示. 关于使用include还是include_once(以下,都包含require_once), 这个讨论很长了, 结论也一直有, 就是尽量使用include, 而不是include_once, 以前最多的理由的是, include_once需要查询一遍已加载的文件列表, 确认是否存在, 然后再加载. 诚然, 这个理由是对的, 不过, 我今天要说的, 是另外一个的原因. 我们知道, PHP去判断一个文件是否被加载, 是需要得到这个文件的opened_path的, 意思是说, 比如:<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">set\\_include\\_path(&quot;/tmp/:/tmp2/&quot;);</span><br><span class=\"line\">include_once(&quot;2.php&quot;);</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure><br><span id=\"more\"></span><br>当PHP看到include_once “2.php”的时候, 他并不知道这个文件的实际路径是什么, 也就无法从已加载的文件列表去判断是否已经加载, 所以在include_once的实现中, 会首先尝试解析这个文件的真实路径(对于普通文件这个解析仅仅类似是检查getcwd和文件路径, 所以如果是相对路径, 一般是不会成功), 如果解析成功, 则查找EG(include_files), 如果存在则说明包含过了, 返回, 否则open这个文件, 从而得到这个文件的opened_path. 比如上面的例子, 这个文件存在于 “/tmp2/2.php”. 然后, 得到了这个opened_path以后, PHP去已加载的文件列表去查找, 是否已经包含, 如果没有包含, 那么就直接compile, 不再需要open file了.</p>\n<ol>\n<li>尝试解析文件的绝对路径, 如果能解析成功, 则检查EG(included_files), 存在则返回, 不存在继续</li>\n<li>打开文件, 得到文件的打开路径(opened path)</li>\n<li>拿opened path去EG(included_files)查找, 是否存在, 如果存在则返回, 不存在继续</li>\n<li>编译文件(compile_file)</li>\n</ol>\n<p>这个在大多数情况下, 不是问题, 然而问题出在当你使用APC的时候… 在使用APC的时候, APC劫持了compile_file这个编译文件的指针, 从而直接从cache中得到编译结果, 避免了对实际文件的open, 避免了对open的system call. 然而, 当你在代码中使用include_once的时候, 在compile_file之前, PHP已经尝试去open file了, 然后才进入被APC劫持的compile file中, 这样一来, 就会产生一次额外的open操作. 而APC正是为了解决这个问题, 引入了include_once_override, 在include_once_override开启的情况下, APC会劫持PHP的ZEND_INCLUDE_OR_EVAL opcode handler, 通过stat来确定文件的绝对路径, 然后如果发现没有被加载, 就改写opcode为include, 做一个tricky解决方案. 但是, 很可惜, 如我所说, APC的include_once_override实现的一直不好, 会有一些未定义的问题, 比如:<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">set\\_include\\_path(&quot;/tmp&quot;);</span><br><span class=\"line\">function a($arg = array()) &#123;</span><br><span class=\"line\">    include_once(&quot;b.php&quot;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">a();</span><br><span class=\"line\">a();</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure><br>然后, 我们的b.php放置在”/tmp/b.php”, 内容如下:<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">  class B &#123;&#125;</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure><br>那么在打开apc.include_once_override的情况下, 连续访问就会得到如下错误:</p>\n<p>  Fatal error - include() : Cannot redeclare class b</p>\n<p>(后记 2012-09-15 02:07:20: 这个APC的bug我已经修复: <a href=\"https://bugs.php.net/bug.php?id=63070\">#63070</a>) 排除这些技术因素, 我也一直认为, 我们应该使用include, 而不是include_once, 因为我们完全能做到自己规划, 一个文件只被加载一次. 还可以借助自动加载, 来做到这一点. 你使用include_once, 只能证明, 你对自己的代码没信心. 所以, 建议大家, 不要再使用include_once</p>\n",
            "tags": [
                "php",
                "php服务器",
                "php函数"
            ]
        },
        {
            "id": "https://erik.xyz/2014/12/17/php-zhen-zheng-duo-xian-cheng-de-shi-yong/",
            "url": "https://erik.xyz/2014/12/17/php-zhen-zheng-duo-xian-cheng-de-shi-yong/",
            "title": "PHP 真正多线程的使用",
            "date_published": "2014-12-17T14:18:00.000Z",
            "content_html": "<p>by <a href=\"http://zyan.cc/user/2/\">张宴</a> PHP 5.3 以上版本，使用pthreads PHP扩展，可以使PHP真正地支持多线程。多线程在处理重复性的循环任务，能够大大缩短程序执行时间。 我之前的文章中说过，大多数网站的性能瓶颈不在PHP服务器上，因为它可以简单地通过横向增加服务器或CPU核数来轻松应对（对于各种云主机，增加 VPS或CPU核数就更方便了，直接以备份镜像增加VPS，连操作系统、环境都不用安装配置），而是在于MySQL数据库。如果用 MySQL 数据库，一条联合查询的SQL，也许就可以处理完业务逻辑，但是，遇到大量并发请求，就歇菜了。如果用 NoSQL 数据库，也许需要十次查询，才能处理完同样地业务逻辑，但每次查询都比 MySQL 要快，十次循环NoSQL查询也许比一次MySQL联合查询更快，应对几万次/秒的查询完全没问题。如果加上PHP多线程，通过十个线程同时查询 NoSQL，返回结果汇总输出，速度就要更快了。我们实际的APP产品中，调用一个通过用户喜好实时推荐商品的PHP接口，PHP需要对BigSea NoSQL数据库发起500~1000次查询，来实时算出用户的个性喜好商品数据，PHP多线程的作用非常明显。 <span id=\"more\"></span><br>PHP扩展下载：<a href=\"https://github.com/krakjoe/pthreads\">https://github.com/krakjoe/pthreads</a> PHP手册文档：<a href=\"http://php.net/manual/zh/book.pthreads.php\">http://php.net/manual/zh/book.pthreads.php</a> 1、扩展的编译安装(Linux），编辑参数 —enable-maintainer-zts 是必选项：<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /Data/tgz/php-5.5.1 ./configure --prefix=/Data/apps/php --with-config-file-path=/Data/apps/php/etc --with-mysql=/Data/apps/mysql --with-mysqli=/Data/apps/mysql/bin/mysql_config --with-iconv-dir --with-freetype-dir=/Data/apps/libs --with-jpeg-dir=/Data/apps/libs --with-png-dir=/Data/apps/libs --with-zlib --with-libxml-dir=/usr --enable-xml --disable-rpath --enable-bcmath --enable-shmop --enable-sysvsem --enable-inline-optimization --with-curl --enable-mbregex --enable-fpm --enable-mbstring --with-mcrypt=/Data/apps/libs --with-gd --enable-gd-native-ttf --with-openssl --with-mhash --enable-pcntl --enable-sockets --with-xmlrpc --enable-zip --enable-soap --enable-opcache --with-pdo-mysql --enable-maintainer-zts make clean make make installunzip pthreads-master.zip cd pthreads-master /Data/apps/php/bin/phpize ./configure --with-php-config=/Data/apps/php/bin/php-config make make install</span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">vi /Data/apps/php/etc/php.ini</span><br></pre></td></tr></table></figure><br>添加：</p>\n<p>extension = “pthreads.so”</p>\n<p>2、给出一段PHP多线程、与For循环，抓取百度搜索页面的PHP代码示例：</p>\n<p><a href=\"http://zyan.cc/#\">view plain</a><a href=\"http://zyan.cc/#\">print</a><a href=\"http://zyan.cc/#\">?</a><br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">   class test\\_thread\\_run extends Thread</span><br><span class=\"line\">   &#123;</span><br><span class=\"line\">      public $url;</span><br><span class=\"line\">      public $data;</span><br><span class=\"line\"></span><br><span class=\"line\">       public function __construct($url)</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">          $this-&gt;url = $url;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      public function run()</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">          if(($url = $this-&gt;url))</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">              $this-&gt;data = model\\_http\\_curl_get($url);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  function model\\_thread\\_result_get($urls_array)</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">      foreach ($urls_array as $key =&gt; $value)</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">          $thread_array\\[$key\\] = new test\\_thread\\_run($value\\[&quot;url&quot;\\]);</span><br><span class=\"line\">          $thread_array\\[$key\\]-&gt;start();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      foreach ($thread_array as $thread\\_array\\_key =&gt; $thread\\_array\\_value)</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">          while($thread_array\\[$thread\\_array\\_key\\]-&gt;isRunning())</span><br><span class=\"line\">           &#123;</span><br><span class=\"line\">              usleep(10);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          if($thread_array\\[$thread\\_array\\_key\\]-&gt;join())</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">              $variable_data\\[$thread\\_array\\_key\\] = $thread_array\\[$thread\\_array\\_key\\]-&gt;data;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      return $variable_data;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  function model\\_http\\_curl_get($url,$userAgent=&quot;&quot;)</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">      $userAgent = $userAgent ? $userAgent : &#x27;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.2)&#x27;;</span><br><span class=\"line\">      $curl = curl_init();</span><br><span class=\"line\">      curl_setopt($curl, CURLOPT_URL, $url);</span><br><span class=\"line\">      curl_setopt($curl, CURLOPT_RETURNTRANSFER, 1);</span><br><span class=\"line\">      curl_setopt($curl, CURLOPT_TIMEOUT, 5);</span><br><span class=\"line\">      curl_setopt($curl, CURLOPT_USERAGENT, $userAgent);</span><br><span class=\"line\">      $result = curl_exec($curl);</span><br><span class=\"line\">      curl_close($curl);</span><br><span class=\"line\">      return $result;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  for ($i=0; $i &lt; 100; $i++)</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">      $urls_array\\[\\] = array(&quot;name&quot; =&gt; &quot;baidu&quot;, &quot;url&quot; =&gt; &quot;http://www.baidu.com/s?wd=&quot;.mt_rand(10000,20000));</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  $t = microtime(true);</span><br><span class=\"line\">  $result = model\\_thread\\_result_get($urls_array);</span><br><span class=\"line\">  $e = microtime(true);</span><br><span class=\"line\">  echo &quot;多线程：&quot;.($e-$t).&quot;\\\\n&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">  $t = microtime(true);</span><br><span class=\"line\">  foreach ($urls_array as $key =&gt; $value)</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">      $result_new\\[$key\\] = model\\_http\\_curl_get($value\\[&quot;url&quot;\\]);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  $e = microtime(true);</span><br><span class=\"line\">  echo &quot;For循环：&quot;.($e-$t).&quot;\\\\n&quot;;</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure></p>\n",
            "tags": [
                "php",
                "php服务器"
            ]
        },
        {
            "id": "https://erik.xyz/2014/12/11/guan-yu-php-fu-dian-shu-ni-ying-gai-zhi-dao-de-all-bogus-about-the-float-in-php/",
            "url": "https://erik.xyz/2014/12/11/guan-yu-php-fu-dian-shu-ni-ying-gai-zhi-dao-de-all-bogus-about-the-float-in-php/",
            "title": "关于PHP浮点数你应该知道的(All ‘bogus’ about the float in PHP)",
            "date_published": "2014-12-11T15:33:00.000Z",
            "content_html": "<p>PHP是一种弱类型语言, 这样的特性, 必然要求有无缝透明的隐式类型转换, PHP内部使用zval来保存任意类型的数值, zval的结构如下(5.2为例):<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">struct \\_zval\\_struct &#123;</span><br><span class=\"line\">    /\\* Variable information */</span><br><span class=\"line\">    zvalue_value value; /\\* value */</span><br><span class=\"line\">    zend_uint refcount;</span><br><span class=\"line\">    zend_uchar type; /\\* active type */</span><br><span class=\"line\">    zend_uchar is_ref;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure><br><span id=\"more\"></span><br>上面的结构中, 实际保存数值本身的是zvalue_value联合体:<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">typedef union \\_zvalue\\_value &#123;</span><br><span class=\"line\">    long lval; /\\* long value */</span><br><span class=\"line\">    double dval; /\\* double value */</span><br><span class=\"line\">    struct &#123;</span><br><span class=\"line\">        char *val;</span><br><span class=\"line\">        int len;</span><br><span class=\"line\">    &#125; str;</span><br><span class=\"line\">    HashTable *ht; /\\* hash table value */</span><br><span class=\"line\">    zend\\_object\\_value obj;</span><br><span class=\"line\">&#125; zvalue_value;</span><br></pre></td></tr></table></figure><br>今天的话题, 我们只关注其中的俩个成员, lval和dval, 我们要意识到, long lval是随着编译器, OS的字长不同而不定长的, 它有可能是32bits或者64bits, 而double dval(双精度)由<a href=\"http://en.wikipedia.org/wiki/IEEE_754-2008\">IEEE 754</a>规定, 是定长的, 一定是64bits. 请记住这一点, 造就了PHP的一些代码的”非平台无关性”. <strong>我们接下来的讨论, 除了特别指明, 都是假设long为64bits</strong> IEEE 754的浮点计数法, 我这里就不引用了, 大家有兴趣的可以自己查看, 关键的一点是, double的尾数采用52位bit来保存, 算上隐藏的1位有效位, 一共是53bits. 在这里, 引出一个很有意思的问题, 我们用c代码举例(假设long为64bits):<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">      long a = x;</span><br><span class=\"line\">      assert(a == (long)(double)a);</span><br></pre></td></tr></table></figure><br>请问, a的取值在什么范围内的时候, 上面的代码可以断言成功?(留在文章最后解答) 现在我们回归正题, PHP在执行一个脚本之前, 首先需要读入脚本, 分析脚本, 这个过程中也包含着, 对脚本中的字面量进行zval化, 比如对于如下脚本:<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">$a = 9223372036854775807; //64位有符号数最大值</span><br><span class=\"line\">$b = 9223372036854775808; //最大值+1</span><br><span class=\"line\">var_dump($a);</span><br><span class=\"line\">var_dump($b);</span><br></pre></td></tr></table></figure><br>输出:<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int(9223372036854775807)</span><br><span class=\"line\">float(9.22337203685E+18)</span><br></pre></td></tr></table></figure><br>也就说, PHP在词法分析阶段, 对于一个字面量的数值, 会去判断, 是否超出了当前系统的long的表值范围, 如果不是, 则用lval来保存, zval为IS_LONG, 否则就用dval表示, zval IS_FLOAT. 凡是大于最大的整数值的数值, 我们都要小心, 因为它可能会有精度损失:<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">$a = 9223372036854775807;</span><br><span class=\"line\">$b = 9223372036854775808;</span><br><span class=\"line\"></span><br><span class=\"line\">var_dump($a === ($b - 1));</span><br></pre></td></tr></table></figure><br>输出是false. 现在接上开头的讨论, 之前说过, PHP的整数, 可能是32位, 也可能是64位, 那么就决定了, 一些在64位上可以运行正常的代码, 可能会因为隐形的类型转换, 发生精度丢失, 从而造成代码不能正常的运行在32位系统上. 所以, 我们一定要警惕这个临界值, 好在PHP中已经定义了这个临界值:<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">    echo PHP\\_INT\\_MAX;</span><br><span class=\"line\"> ?&gt;</span><br></pre></td></tr></table></figure><br>当然, 为了保险起见, 我们应该使用字符串来保存大整数, 并且采用比如<a href=\"http://www.php.net/manual/en/book.bc.php\">bcmath</a>这样的数学函数库来进行计算. 另外, 还有一个关键的配置, 会让我们产生迷惑, 这个配置就是<a href=\"http://www.php.net/manual/en/ini.core.php#ini.precision\">php.precision</a>, 这配置决定了PHP再输出一个float值的时候, 输出多少有效位. 最后, 我们再来回头看上面提出的问题, 也就是一个long的整数, 最大的值是多少, 才能保证转到float以后再转回long不会发生精度丢失? 比如, 对于整数, 我们知道它的二进制表示是, 101, 现在, 让我们右移俩位, 变成1.01, 舍去高位的隐含有效位1, 我们得到在double中存储5的二进制数值为:</p>\n<ol>\n<li>0/<em>符号位</em>/ 10000000001/<em>指数位</em>/ 0100000000000000000000000000000000000000000000000000</li>\n</ol>\n<p>5的二进制表示, 丝毫未损的保存在了尾数部分, 这个情况下, 从double转会回long, 不会发生精度丢失. 我们知道double用52位表示尾数, 算上隐含的首位1, 一共是53位精度.. 那么也就可以得出, 如果一个long的整数, 值小于:</p>\n<ol>\n<li>2^53 - 1 == 9007199254740991; //牢记, 我们现在假设是64bits的long</li>\n</ol>\n<p>那么, 这个整数, 在发生long-&gt;double-&gt;long的数值转换时, 不会发生精度丢失. 原始文章出自： <a href=\"http://www.laruence.com/2011/12/19/2399.html\" title=\"Permanet Link to 关于PHP浮点数你应该知道的(All ‘bogus’ about the float in PHP)\">http://www.laruence.com/2011/12/19/2399.html</a></p>\n",
            "tags": [
                "php",
                "php服务器",
                "centos"
            ]
        },
        {
            "id": "https://erik.xyz/2014/12/10/linux-xia-shi-yong-tar-ming-ling/",
            "url": "https://erik.xyz/2014/12/10/linux-xia-shi-yong-tar-ming-ling/",
            "title": "linux下使用tar命令",
            "date_published": "2014-12-10T14:33:00.000Z",
            "content_html": "<p>解压 语法：tar [主选项+辅选项] 文件或者目录 使用该命令时，主选项是必须要有的，它告诉tar要做什么事情，辅选项是辅助使用的，可以选用。 </p>\n<p><strong>主选项：</strong></p>\n<p>c 创建新的档案文件。如果用户想备份一个目录或是一些文件，就要选择这个选项。相当于打包。</p>\n<p>x 从档案文件中释放文件。相当于拆包。 </p>\n<p>t 列出档案文件的内容，查看已经备份了哪些文件。 </p>\n<p>特别注意，在参数的下达中， c/x/t 仅能存在一个！不可同时存在！因为不可能同时压缩与解压缩。 <span id=\"more\"></span></p>\n<p><strong>辅助选项：</strong> </p>\n<p>-z ：是否同时具有 gzip 的属性？亦即是否需要用 gzip 压缩或解压？ 一般格式为xx.tar.gz或xx. tgz </p>\n<p>-j ：是否同时具有 bzip2 的属性？亦即是否需要用 bzip2 压缩或解压？一般格式为xx.tar.bz2 </p>\n<p>-v ：压缩的过程中显示文件！这个常用 -f ：使用档名，请留意，在 f 之后要立即接档名喔！不要再加其他参数！</p>\n<p>-p ：使用原文件的原来属性（属性不会依据使用者而变） —exclude FILE：在压缩的过程中，不要将 FILE 打包！<br><strong>范例：</strong> 范例一：<br>将整个 /etc 目录下的文件全部打包成为 /tmp/etc.tar </p>\n<p>tar -cvf /tmp/etc.tar /etc　　</p>\n<p>&lt;==仅打包，不压缩！  tar -zcvf /tmp/etc.tar.gz /etc　　</p>\n<p>&lt;==打包后，以 gzip 压缩  tar -jcvf /tmp/etc.tar.bz2 /etc　</p>\n<p>&lt;==打包后，以 bzip2 压缩 </p>\n<h1 id=\"特别注意，在参数-f-之后的文件档名是自己取的，我们习惯上都用-tar-来作为辨识。\"><a href=\"#特别注意，在参数-f-之后的文件档名是自己取的，我们习惯上都用-tar-来作为辨识。\" class=\"headerlink\" title=\"特别注意，在参数 f 之后的文件档名是自己取的，我们习惯上都用 .tar 来作为辨识。\"></a>特别注意，在参数 f 之后的文件档名是自己取的，我们习惯上都用 .tar 来作为辨识。</h1><h1 id=\"如果加-z-参数，则以-tar-gz-或-tgz-来代表-gzip-压缩过的-tar-file-～\"><a href=\"#如果加-z-参数，则以-tar-gz-或-tgz-来代表-gzip-压缩过的-tar-file-～\" class=\"headerlink\" title=\"如果加 z 参数，则以 .tar.gz 或 .tgz 来代表 gzip 压缩过的 tar file ～\"></a>如果加 z 参数，则以 .tar.gz 或 .tgz 来代表 gzip 压缩过的 tar file ～</h1><h1 id=\"如果加-j-参数，则以-tar-bz2-来作为附档名啊～\"><a href=\"#如果加-j-参数，则以-tar-bz2-来作为附档名啊～\" class=\"headerlink\" title=\"如果加 j 参数，则以 .tar.bz2 来作为附档名啊～\"></a>如果加 j 参数，则以 .tar.bz2 来作为附档名啊～</h1><h1 id=\"上述指令在执行的时候，会显示一个警告讯息：-『tar-Removing-leading-“-from-member-names』那是关於绝对路径的特殊设定。\"><a href=\"#上述指令在执行的时候，会显示一个警告讯息：-『tar-Removing-leading-“-from-member-names』那是关於绝对路径的特殊设定。\" class=\"headerlink\" title=\"上述指令在执行的时候，会显示一个警告讯息： # 『tar: Removing leading /“ from member names』那是关於绝对路径的特殊设定。\"></a>上述指令在执行的时候，会显示一个警告讯息： # 『tar: Removing leading /“ from member names』那是关於绝对路径的特殊设定。</h1><p>范例二：</p>\n<p>查阅上述 /tmp/etc.tar.gz 文件内有哪些文件？ </p>\n<p>tar -ztvf /tmp/etc.tar.gz </p>\n<h1 id=\"由於我们使用-gzip-压缩，所以要查阅该-tar-file-内的文件时，\"><a href=\"#由於我们使用-gzip-压缩，所以要查阅该-tar-file-内的文件时，\" class=\"headerlink\" title=\"由於我们使用 gzip 压缩，所以要查阅该 tar file 内的文件时，\"></a>由於我们使用 gzip 压缩，所以要查阅该 tar file 内的文件时，</h1><h1 id=\"就得要加上-z-这个参数了！这很重要的！\"><a href=\"#就得要加上-z-这个参数了！这很重要的！\" class=\"headerlink\" title=\"就得要加上 z 这个参数了！这很重要的！\"></a>就得要加上 z 这个参数了！这很重要的！</h1><p>范例三：</p>\n<p>将 /tmp/etc.tar.gz 文件解压缩在 /usr/local/src 底下</p>\n<p> cd /usr/local/src</p>\n<p> tar -zxvf /tmp/etc.tar.gz </p>\n<h1 id=\"在预设的情况下，我们可以将压缩档在任何地方解开的！以这个范例来说\"><a href=\"#在预设的情况下，我们可以将压缩档在任何地方解开的！以这个范例来说\" class=\"headerlink\" title=\"在预设的情况下，我们可以将压缩档在任何地方解开的！以这个范例来说\"></a>在预设的情况下，我们可以将压缩档在任何地方解开的！以这个范例来说</h1><h1 id=\"我先将工作目录变换到-usr-local-src-底下，并且解开-tmp-etc-tar-gz\"><a href=\"#我先将工作目录变换到-usr-local-src-底下，并且解开-tmp-etc-tar-gz\" class=\"headerlink\" title=\"我先将工作目录变换到 /usr/local/src 底下，并且解开 /tmp/etc.tar.gz\"></a>我先将工作目录变换到 /usr/local/src 底下，并且解开 /tmp/etc.tar.gz</h1><h1 id=\"则解开的目录会在-usr-local-src-etc-，另外，如果您进入-usr-local-src-etc\"><a href=\"#则解开的目录会在-usr-local-src-etc-，另外，如果您进入-usr-local-src-etc\" class=\"headerlink\" title=\"则解开的目录会在 /usr/local/src/etc ，另外，如果您进入 /usr/local/src/etc\"></a>则解开的目录会在 /usr/local/src/etc ，另外，如果您进入 /usr/local/src/etc</h1><h1 id=\"则会发现，该目录下的文件属性与-etc-可能会有所不同喔！\"><a href=\"#则会发现，该目录下的文件属性与-etc-可能会有所不同喔！\" class=\"headerlink\" title=\"则会发现，该目录下的文件属性与 /etc/ 可能会有所不同喔！\"></a>则会发现，该目录下的文件属性与 /etc/ 可能会有所不同喔！</h1><p>范例四：</p>\n<p>在 /tmp 底下，我只想要将 /tmp/etc.tar.gz 内的 etc/passwd 解开而已 </p>\n<p> cd /tmp </p>\n<p> tar -zxvf /tmp/etc.tar.gz etc/passwd </p>\n<h1 id=\"我可以透过-tar-ztvf-来查阅-tarfile-内的文件名称，如果单只要一个文件，\"><a href=\"#我可以透过-tar-ztvf-来查阅-tarfile-内的文件名称，如果单只要一个文件，\" class=\"headerlink\" title=\"我可以透过 tar -ztvf 来查阅 tarfile 内的文件名称，如果单只要一个文件，\"></a>我可以透过 tar -ztvf 来查阅 tarfile 内的文件名称，如果单只要一个文件，</h1><h1 id=\"就可以透过这个方式来下达！注意到！-etc-tar-gz-内的根目录-是被拿掉了！\"><a href=\"#就可以透过这个方式来下达！注意到！-etc-tar-gz-内的根目录-是被拿掉了！\" class=\"headerlink\" title=\"就可以透过这个方式来下达！注意到！ etc.tar.gz 内的根目录 / 是被拿掉了！\"></a>就可以透过这个方式来下达！注意到！ etc.tar.gz 内的根目录 / 是被拿掉了！</h1><p>范例五：</p>\n<p>我要备份 /home, /etc ，但不要 /home/dmtsai </p>\n<p>tar —exclude /home/dmtsai -zcvf myfile.tar.gz /home/<em> /etc   </em></p>\n<p><em>另外：tar命令的C参数</em></p>\n<p><strong>tar -cvf file2.tar /home/usr2/file2</strong></p>\n<p>tar: Removing leading ‘/‘ from members names home/usr2/file2 该命令可以将/home/usr2/file2文件打包到当前目录下的file2.tar中，需要注意的是：使用绝对路径标识的源文件，在用tar命令压缩后，文件名连同绝对路径（这里是home/usr2/，根目录’/‘被自动去掉了）一并被压缩进来。使用tar命令解压缩后会出现以下情况： $ tar -xvf file2.tar $ ls …… …… home …… …… 解压缩后的文件名不是想象中的file2，而是home/usr2/file2。 </p>\n<p><strong>tar -cvf file2.tar -C /home/usr2 file2</strong></p>\n<p>该命令中的-C dir参数，将tar的工作目录从当前目录改为/home/usr2，将file2文件（不带绝对路径）压缩到file2.tar中。注意：-C dir参数的作用在于改变工作目录，其有效期为该命令中下一次-C dir参数之前。 使用tar的-C dir参数，同样可以做到在当前目录/home/usr1下将文件解压缩到其他目录，例如：</p>\n<p><strong>tar -xvf file2.tar -C /home/usr2</strong> </p>\n<p>而tar不用-C dir参数时是无法做到的：</p>\n<p>tar -xvf file2.tar /home/usr2 tar: /tmp/file: Not found in archive tar: Error exit delayed from previous errors</p>\n",
            "tags": [
                "php服务器",
                "centos",
                "linux"
            ]
        },
        {
            "id": "https://erik.xyz/2014/12/09/shi-yong-de-php-zheng-ze-biao-da-shi/",
            "url": "https://erik.xyz/2014/12/09/shi-yong-de-php-zheng-ze-biao-da-shi/",
            "title": "实用的PHP正则表达式",
            "date_published": "2014-12-09T01:45:00.000Z",
            "content_html": "<p>正则表达式是程序开发中一个重要的元素，它提供用来描述或匹配文本的字符串，如特定的字符、词或算式等。但在某些情况下，用正则表达式去验证一个字符串比较复杂和费时。本文为你介绍10种常见的实用PHP正则表达式的写法，希望对你的工作有所帮助。 <strong>1. 验证E-mail地址</strong> 这是一个用于验证电子邮件的正则表达式。但它并不是高效、完美的解决方案。在此不推荐使用。</p>\n<p>Php代码<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$email = &quot;test@ansoncheung.tk&quot;;</span><br><span class=\"line\">if (preg_match(&#x27;/^\\[^0-9\\]\\[a-zA-Z0-9_\\]+(\\[.\\]\\[a-zA-Z0-9_\\]+)*\\[@\\]\\[a-zA-Z0-9_\\]+(\\[.\\]\\[a-zA-Z0-9_\\]+)*\\[.\\]\\[a-zA-Z\\]&#123;2,4&#125;$/&#x27;,$email)) &#123;</span><br><span class=\"line\">    echo &quot;Your email is ok.&quot;;</span><br><span class=\"line\">&#125; else &#123;</span><br><span class=\"line\">    echo &quot;Wrong email address format&quot;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br><span id=\"more\"></span><br>为了更加有效验证电子邮件地址，推荐使用<a href=\"http://php.net/manual/en/function.filter-var.php\">filer_var</a>。</p>\n<p>Php代码<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (filter_var(&#x27;test+email@ansoncheung&#x27;, FILTER\\_VALIDATE\\_EMAIL)) &#123;</span><br><span class=\"line\">    echo &quot;Your email is ok.&quot;;</span><br><span class=\"line\">&#125; else &#123;</span><br><span class=\"line\">    echo &quot;Wrong email address format.&quot;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br><strong>2. 验证用户名</strong> 这是一个用于验证用户名的实例，其中包括字母、数字（A-Z，a-z，0-9）、下划线以及最低5个字符，最大20个字符。同时，也可以根据需要，对最小值和最大值做合理的修改。</p>\n<p>Php代码<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$username = &quot;user_name12&quot;;</span><br><span class=\"line\">if (preg_match(&#x27;/^\\[a-z\\\\d_\\]&#123;5,20&#125;$/i&#x27;, $username)) &#123;</span><br><span class=\"line\">    echo &quot;Your username is ok.&quot;;</span><br><span class=\"line\">&#125; else &#123;</span><br><span class=\"line\">    echo &quot;Wrong username format.&quot;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br><strong>3. 验证电话号码</strong> 这是一个验证美国电话号码的实例。</p>\n<p>Php代码<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$phone = &quot;(021)423-2323&quot;;</span><br><span class=\"line\">if (preg_match(&#x27;/\\\\(?\\\\d&#123;3&#125;\\\\)?\\[-\\\\s.\\]?\\\\d&#123;3&#125;\\[-\\\\s.\\]\\\\d&#123;4&#125;/x&#x27;, $phone)) &#123;</span><br><span class=\"line\">    echo &quot;Your phone number is ok.&quot;;</span><br><span class=\"line\">&#125; else &#123;</span><br><span class=\"line\">    echo &quot;Wrong phone number.&quot;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br><strong>4. 验证IP地址</strong> 这是一个用来验证IPv4地址的实例。</p>\n<p>Php代码<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$IP = &quot;198.168.1.78&quot;;</span><br><span class=\"line\">if (preg_match(&#x27;/^((\\[1-9\\]?\\[0-9\\]|1\\[0-9\\]&#123;2&#125;|2\\[0-4\\]\\[0-9\\]|25\\[0-5\\]).)&#123;3&#125;(\\[1-9\\]?\\[0-9\\]|1\\[0-9\\]&#123;2&#125;|2\\[0-4\\]\\[0-9\\]|25\\[0-5\\])$/&#x27;,$IP)) &#123;</span><br><span class=\"line\">    echo &quot;Your IP address is ok.&quot;;</span><br><span class=\"line\">&#125; else &#123;</span><br><span class=\"line\">    echo &quot;Wrong IP address.&quot;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br><strong>5. 验证邮政编码</strong> 这是一个用来验证邮政编码的实例。</p>\n<p>Php代码<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$zipcode = &quot;12345-5434&quot;;</span><br><span class=\"line\">if (preg_match(&quot;/^(\\[0-9\\]&#123;5&#125;)(-\\[0-9\\]&#123;4&#125;)?$/i&quot;,$zipcode)) &#123;</span><br><span class=\"line\">    echo &quot;Your Zip code is ok.&quot;;</span><br><span class=\"line\">&#125; else &#123;</span><br><span class=\"line\">    echo &quot;Wrong Zip code.&quot;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br><strong>6. 验证SSN（社会保险号）</strong> 这是一个验证美国SSN的实例。</p>\n<p>Php代码<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ssn = &quot;333-23-2329&quot;;</span><br><span class=\"line\">if (preg_match(&#x27;/^\\[\\\\d\\]&#123;3&#125;-\\[\\\\d\\]&#123;2&#125;-\\[\\\\d\\]&#123;4&#125;$/&#x27;,$ssn)) &#123;</span><br><span class=\"line\">    echo &quot;Your SSN is ok.&quot;;</span><br><span class=\"line\">&#125; else &#123;</span><br><span class=\"line\">    echo &quot;Wrong SSN.&quot;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br><strong>7. 验证信用卡号</strong></p>\n<p>Php代码<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$cc = &quot;378282246310005&quot;;</span><br><span class=\"line\">if (preg_match(&#x27;/^(?:4\\[0-9\\]&#123;12&#125;(?:\\[0-9\\]&#123;3&#125;)?|5\\[1-5\\]\\[0-9\\]&#123;14&#125;|6011\\[0-9\\]&#123;12&#125;|3(?:0\\[0-5\\]|\\[68\\]\\[0-9\\])\\[0-9\\]&#123;11&#125;|3\\[47\\]\\[0-9\\]&#123;13&#125;)$/&#x27;, $cc)) &#123;</span><br><span class=\"line\">    echo &quot;Your credit card number is ok.&quot;;</span><br><span class=\"line\">&#125; else &#123;</span><br><span class=\"line\">    echo &quot;Wrong credit card number.&quot;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br><strong>8. 验证域名</strong></p>\n<p>Php代码<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$url = &quot;http://ansoncheung.tk/&quot;;</span><br><span class=\"line\">if (preg_match(&#x27;/^(http|https|ftp):\\\\/\\\\/(\\[A-Z0-9\\]\\[A-Z0-9_-\\]*(?:\\\\.\\[A-Z0-9\\]\\[A-Z0-9_-\\]*)+):?(\\\\d+)?\\\\/?/i&#x27;, $url)) &#123;</span><br><span class=\"line\">    echo &quot;Your url is ok.&quot;;</span><br><span class=\"line\">&#125; else &#123;</span><br><span class=\"line\">    echo &quot;Wrong url.&quot;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br><strong>9. 从特定URL中提取域名</strong></p>\n<p>Php代码<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> $url = &quot;http://ansoncheung.tk/articles&quot;;</span><br><span class=\"line\"> preg_match(&#x27;@^(?:http://)?(\\[^/\\]+)@i&#x27;, $url, $matches);</span><br><span class=\"line\"> $host = $matches\\[1\\];</span><br><span class=\"line\"></span><br><span class=\"line\">echo $host;</span><br></pre></td></tr></table></figure><br><strong>10. 将文中关键词高亮显示</strong></p>\n<p>Php代码 </p>\n <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$text = &quot;Sample sentence from AnsonCheung.tk, regular expression has become popular in web programming. Now we learn regex. According to wikipedia, Regular expressions (abbreviated as regex or regexp, with plural forms regexes, regexps, or regexen) are written in a formal language that can be interpreted by a regular expression processor&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">$text = preg_replace(&quot;/\\\\b(regex)\\\\b/i&quot;, &#x27;&lt;span style=&quot;background:#5fc9f6&quot;&gt;\\\\1&lt;/span&gt;&#x27;, $text);</span><br><span class=\"line\"></span><br><span class=\"line\"> echo $text;</span><br></pre></td></tr></table></figure>\n<p>原文来自<a href=\"http://www.iteye.com/news/23231\">http://www.iteye.com/news/23231</a>  <a href=\"http://webmaster.iteye.com\">ITeye黑板报</a></p>\n",
            "tags": [
                "php",
                "php服务器",
                "php正则",
                "正则"
            ]
        },
        {
            "id": "https://erik.xyz/2014/10/31/shen-qing-yong-jiu-mian-fei-kong-jian-shu-ju-ku-kong-jian-yu-ming/",
            "url": "https://erik.xyz/2014/10/31/shen-qing-yong-jiu-mian-fei-kong-jian-shu-ju-ku-kong-jian-yu-ming/",
            "title": "申请永久免费空间、数据库空间、域名",
            "date_published": "2014-10-31T10:01:00.000Z",
            "content_html": "<p>最近因为百度bat封了（要收费），新浪sea数据库上传有限制。干脆找一下免费资源，这还真找到了。 <a href=\"http://free.5944.net\">http://free.5944.net</a>      这个网站只要已注册就有1000MB的免费空间 <a href=\"http://www.freehao123.com/freedns-afraid-org/\">http://www.freehao123.com/freedns-afraid-org/</a>     这篇文章介绍了怎么申请永久性域名（二级）不用备案，可以申请多个，而且还可以有DNS解析。 <a href=\"http://www.pdxx.net\">http://www.pdxx.net</a>    说说这个网站吧，卖服务器的，可以提供免费空间(300mb)、数据库空间（10mb但是免费空间不备案就用不了，这是我遇到的问题。 <a href=\"http://www.ywxa.com\">http://www.ywxa.com</a> 充值1元可以申请1GB免费mysql 空间，10GB的空间。我只能说碉堡了，这估计是最大的免费，只有一年的年限，后续收费。 下面这两个都是提供免费10G空间，但是巨网的要收费一年1元，另外一个不收费 <a href=\"http://www.id666.com\">http://www.id666.com</a> <a href=\"http://www.jwkp.com\">http://www.jwkp.com</a></p>\n",
            "tags": [
                "php服务器",
                "免费",
                "免费服务器",
                "空间",
                "资源"
            ]
        },
        {
            "id": "https://erik.xyz/2014/10/31/centos6-5-ben-di-an-zhuang-shi-pin-bo-fang-qi/",
            "url": "https://erik.xyz/2014/10/31/centos6-5-ben-di-an-zhuang-shi-pin-bo-fang-qi/",
            "title": "centos6.5本地安装视频播放器",
            "date_published": "2014-10-31T09:57:00.000Z",
            "content_html": "<p><a href=\"http://www.erik.xyz/ctspbf/\"><img src=\"http://i2.tietuku.com/706b2fbb5793484a.jpg\" alt=\"木木夕\"></a> 安装来centos6.5很郁闷的是自带的播放器好多视频不支持（你懂的哦）。怎么办呢？？ 老规矩先度娘，后谷歌。。。 度娘的伙伴们大部分都是mplayer那我也随众人吧 首先下载文件MPlayer-1.1.tar.gz和yasm-1.2.0.tar.gz mplayer <a href=\"http://download.csdn.net/detail/w15875510692/7708613\">http://download.csdn.net/detail/w15875510692/7708613</a> yasm <a href=\"http://download.csdn.net/detail/w15875510692/7708623\">http://download.csdn.net/detail/w15875510692/7708623</a> 解压先安装yasm 再安装mplayer ./configure —enable-gui 之后 make &amp;&amp; make install 漫长的等待吧 安装完成后 cd /usar/share/mplayer/skins cp Blue /usr/local/share/mplayer/skins/ -r cd /usr/local/share/mplayer/skins/ mv Blue/ default modprobe snd_pcm_oss 输入gmplayer打开播放器</p>\n",
            "tags": [
                "php服务器",
                "centos",
                "linux"
            ]
        },
        {
            "id": "https://erik.xyz/2014/10/30/linux-xi-tong-fang-wen-windows-xi-tong-de-ying-pan-ntfs-ying-pan/",
            "url": "https://erik.xyz/2014/10/30/linux-xi-tong-fang-wen-windows-xi-tong-de-ying-pan-ntfs-ying-pan/",
            "title": "linux系统访问windows系统的硬盘ntfs硬盘",
            "date_published": "2014-10-30T02:14:00.000Z",
            "content_html": "<p><a href=\"http://www.erik.xyz/lwnygpan/\"><img src=\"http://i2.tietuku.com/5f7e22bbaa82f3ff.jpg\" alt=\"木木夕图片\"></a> 这边介绍的是NTFS-3G挂载ntfs硬盘 首先，确认你的linux系统是否已经安装GCC不然源码包没法编译的<br>输入命令行   yum -y install gcc<br>创建位于mnt文件下的www文件<br><span id=\"more\"></span><br>第二步，下载NTFS-3G依赖软件。FUSE下载地址 <a href=\"http://sourceforge.net/projects/fuse/files/fuse-2.X/2.9.0/fuse-2.9.0.tar.gz/download\">http://sourceforge.net/projects/fuse/files/fuse-2.X/2.9.0/fuse-2.9.0.tar.gz/download</a>   版本可以自己选<br>安装<br>1，解压命令       tar -xvzf fuse-2.9.0.tar.gz<br>2，复制    cd fuse-2.9.0<br>3，安装   ./configure &amp;&amp; make &amp;&amp; make install </p>\n<p>第三部，安装NTFS-3G驱动。下载地址 <a href=\"http://tuxera.com/opensource/ntfs-3g\\_ntfsprogs-2014.2.15.tgz\">http://tuxera.com/opensource/ntfs-3g\\_ntfsprogs-2014.2.15.tgz</a> tar -xvzf ntfs-3g_ntfsprogs-2014.2.15.tgz cd ntfs-3g_ntfsprogs-2014.2.15<br>./configure &amp;&amp; make &amp;&amp; make install<br>第四部，挂载ntfs格式硬盘 mount -t ntfs-3g /dev/sda1 /mnt/www<br>自动挂载 fdisk -l 可获得硬盘信息 一般sda1是c盘依次类推， sdb1是移动硬盘 vi /etc/fstab 在最后面添加 /dev/sda6 /mnt/www/d ntfs-3g defaults,umask=000 0 0 /dev/sda5 /mnt/www/d ntfs-3g defaults,umask=000 0 0 /dev/sdb6 /mnt/www/d ntfs-3g defaults,umask=000 0 0</p>\n",
            "tags": [
                "php服务器",
                "centos",
                "linux"
            ]
        },
        {
            "id": "https://erik.xyz/2014/10/21/apache-fu-wu-qi-duo-zhan-dian-pei-zhi/",
            "url": "https://erik.xyz/2014/10/21/apache-fu-wu-qi-duo-zhan-dian-pei-zhi/",
            "title": "apache服务器多站点配置",
            "date_published": "2014-10-21T10:24:00.000Z",
            "content_html": "<p>群里有网友说不知道phpstudy怎配置多站点，其实这个不难，我当初配置的不是集成环境，集成环境和不是集成环境都一样的配置 首先我们要找到apache配置文件 E:\\phpStudy\\Apache\\conf\\httpd.conf 然后打开文件查找httpd-vhosts.conf 于是我们查找到 <a href=\"http://www.erik.xyz/wp-content/uploads/2014/10/20141021175554.png\"><img src=\"http://www.erik.xyz/wp-content/uploads/2014/10/20141021175554-300x53.png\" alt=\"apache\"></a> <span id=\"more\"></span>去掉前面的# 然后按这个路径找到httpd-vhosts.conf文件并打开 找到这段 # # VirtualHost example: # Almost any Apache directive may go into a VirtualHost container. # The first VirtualHost section is used for all requests that do not # match a ServerName or ServerAlias in any <VirtualHost> block. # 看看前面有 NameVirtualHost <em>:80 如果没有就加上 然后找到 #&lt;VirtualHost </em>:80&gt; #    ServerAdmin webmaster@dummy-host.example.com #    DocumentRoot “/Apache24/docs/dummy-host.example.com” #    ServerName dummy-host.example.com #    ServerAlias www.dummy-host.example.com #    ErrorLog “logs/dummy-host.example.com-error.log” #    CustomLog “logs/dummy-host.example.com-access.log” common #</VirtualHost> #<VirtualHost *:80> #    ServerAdmin webmaster@dummy-host2.example.com #    DocumentRoot “/Apache24/docs/dummy-host2.example.com” #    ServerName dummy-host2.example.com #    ErrorLog “logs/dummy-host2.example.com-error.log” #    CustomLog “logs/dummy-host2.example.com-access.log” common #</VirtualHost> 去掉前面的#后，修改路径和域名 <a href=\"http://www.erik.xyz/wp-content/uploads/2014/10/s20141021181957.png\"><img src=\"http://www.erik.xyz/wp-content/uploads/2014/10/s20141021181957-300x207.png\" alt=\"虚拟站点配置\"></a> 到此结束，建议最好用独立配置，别用集成环境，集成环境配置的东西太多容易冲突出错，此方法仅限在服务器上运行，本地运行没测试过，目前不清楚。</p>\n",
            "tags": [
                "php服务器",
                "centos",
                "linux"
            ]
        },
        {
            "id": "https://erik.xyz/2014/10/12/php-ji-cheng-huan-jing/",
            "url": "https://erik.xyz/2014/10/12/php-ji-cheng-huan-jing/",
            "title": "php集成环境",
            "date_published": "2014-10-12T02:17:00.000Z",
            "content_html": "<p>单独配置php环境比较浪费时间，用集成环境速度快，但是添加扩展比较麻烦，总之各有好处。</p>\n<h3 id=\"win系统中php集成环境\"><a href=\"#win系统中php集成环境\" class=\"headerlink\" title=\"win系统中php集成环境\"></a>win系统中php集成环境</h3><p>phpstudy这个集成目前算是比较优秀的基本上涵盖所有php版本和服务其配置，可以任意切换不同版本，相对于开发者来说，一些框架的特殊要求，不必再来回更换php版本。 下载地址 <a href=\"https://sourceforge.net/projects/erik1314/files/win_all/phpStudy-x64.zip\">phpStudy-x64.zip</a> <a href=\"https://sourceforge.net/projects/erik1314/files/win_all/phpStudy-install.zip\">phpStudy-install.zip</a> <a href=\"https://sourceforge.net/projects/erik1314/files/win_all/phpStudy2014.1404454619.rar\">phpStudy2014.1404454619.rar</a> <a href=\"https://sourceforge.net/projects/erik1314/files/win_all/phpStudy2013.zip\">phpStudy2013.zip</a> 默认mysql用户名密码都是root appserv集成环境也一般般，只是目前只看到32位的，不过也符合一些公司使用 下载地址 <a href=\"https://sourceforge.net/projects/erik1314/files/win_all/appserv-win32-2.5.10.exe\">appserv-win32-2.5.10.exe</a>  <span id=\"more\"></span></p>\n<h3 id=\"linux集成环境\"><a href=\"#linux集成环境\" class=\"headerlink\" title=\"linux集成环境\"></a>linux集成环境</h3><p>笔者刚开始接触php由于配置比较繁琐，花费时间量大，干脆在百度上找找看有没有集成环境，后来找到了。 wdlinux这是一款专注于linux集成的环境，对于配置大有好处，后台还有专门的管理界面，可以分站点建立多个网站 下载地址 <a href=\"https://sourceforge.net/projects/erik1314/files/linux_all/wdcp.sh\">wdlinux</a> wget <a href=\"https://sourceforge.net/projects/erik1314/files/linux_all/wdcp.sh\">https://sourceforge.net/projects/erik1314/files/linux_all/wdcp.sh</a> <a href=\"https://sourceforge.net/projects/erik1314/files/linux_all/lanmp_v2.5.tar.gz\">lanmp_v2.5.tar.gz</a> wget <a href=\"https://sourceforge.net/projects/erik1314/files/linux\\_all/lanmp\\_v2.5.tar.gz\">https://sourceforge.net/projects/erik1314/files/linux\\_all/lanmp\\_v2.5.tar.gz</a> wdcp管理系统后台访问地址 <a href=\"http://ip:8080\">http://ip:8080</a> 默认用户密码 admin wdlinux.cn mysql默认的用户密码 root wdlinux.cn phpstudy我就不过多介绍了，也有linux版本的 下载地址 <a href=\"https://sourceforge.net/projects/erik1314/files/linux_all/phpstudy.bin\">phpstudy</a> wget <a href=\"https://sourceforge.net/projects/erik1314/files/linux_all/phpstudy.bin\">https://sourceforge.net/projects/erik1314/files/linux_all/phpstudy.bin</a></p>\n",
            "tags": [
                "php",
                "php服务器",
                "php环境",
                "php集成环境",
                "服务器集成环境"
            ]
        },
        {
            "id": "https://erik.xyz/2014/10/04/lanmp-du-li-er-pei-zhi/",
            "url": "https://erik.xyz/2014/10/04/lanmp-du-li-er-pei-zhi/",
            "title": "lanmp独立而配置",
            "date_published": "2014-10-04T05:02:00.000Z",
            "content_html": "<p>(一)安装yum<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@delphi ~\\]# cd /etc/yum.repos.d/</span><br><span class=\"line\">[root@delphi yum.repos.d\\]# ls</span><br><span class=\"line\">CentOS-Base.repo CentOS-Debuginfo.repo CentOS-Media.repo CentOS-Vault.repo</span><br><span class=\"line\">[root@delphi yum.repos.d\\]# vi CentOS-Media.repo </span><br><span class=\"line\"># CentOS-Media.repo</span><br><span class=\"line\">#</span><br><span class=\"line\"># This repo can be used with mounted DVD media, verify the mount point for</span><br><span class=\"line\"># CentOS-6. You can use this repo and yum to install items directly off the</span><br><span class=\"line\"># DVD ISO that we release.</span><br><span class=\"line\">#</span><br><span class=\"line\"># To use this repo, put in your DVD and use it with the other repos too:</span><br><span class=\"line\"># yum --enablerepo=c6-media \\[command\\]</span><br><span class=\"line\">#</span><br><span class=\"line\"># or for ONLY the media repo, do this:</span><br><span class=\"line\">#</span><br><span class=\"line\"># yum --disablerepo=\\\\* --enablerepo=c6-media \\[command\\]</span><br></pre></td></tr></table></figure><br><span id=\"more\"></span><br>[c6-media]<br>name=CentOS-$releasever - Media<br>baseurl=file:///mnt/cdrom/     #指定了三个光盘有可能挂载的路径。<br>file:///media/cdrom/<br>file:///media/cdrecorder/<br>gpgcheck=1<br>enabled=1     #enabled=0 这里的0代表缺省源不存在，1代表启用。<br>gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6</p>\n<p># wq保存退出。</p>\n<p>  如果你的linux能够上互联网，那么备份Base这个配置文件。</p>\n<p>[root@delphi yum.repos.d]# mv CentOS-Base.repo CentOS-Base.repo.bak</p>\n<pre><code>(二)保证你的电脑里安装了gcc gcc-c++ make,如果没有应该先安装\n</code></pre><p>[root@delphi ~]# yum install gcc -y<br>[root@delphi ~]# yum install gcc-c++ -y</p>\n<pre><code>(三)卸载apache php mysql rpm软件包。我的系统里没有装。方法很多，不一一罗列。 查看服务有没有启动：\n</code></pre><p>[root@delphi ~]# service httpd status<br>httpd: 未被识别的服务<br>[root@delphi ~]# service mysqld status<br>mysqld: 未被识别的服务</p>\n<p>[root@delphi ~]# rpm -qa httpd<br>[root@delphi ~]# rpm -qa mysql<br>[root@delphi ~]# rpm -qa mysqld<br>[root@delphi ~]# rpm -qa | grep php</p>\n<p>  如果你的系统里有这些包，那么rpm -e packagename或者yum remove packagename（解决依赖卸载）。   (四)关闭SElinux 允许iptables相关端口 1.关闭selinux的两种方法。—永久关闭。（需要重启系统）</p>\n<p>[root@delphi ~]# vi /etc/sysconfig/selinux</p>\n<p># This file controls the state of SELinux on the system.<br># SELINUX= can take one of these three values:<br># enforcing - SELinux security policy is enforced.<br># permissive - SELinux prints warnings instead of enforcing.<br># disabled - No SELinux policy is loaded.<br>SELINUX=disabled     # 把SELINUX=enforcing 更改为SELINUX=disabled<br># SELINUXTYPE= can take one of these two values:<br># targeted - Targeted processes are protected,<br># mls - Multi Level Security protection.<br>SELINUXTYPE=targeted</p>\n<p>2.临时关闭（不需要重启系统）</p>\n<p>[root@delphi ~]# setenforce 0</p>\n<p>(五)准备源码部署需要安装的所有源代码包  </p>\n<p> linux命令下载</p>\n<p> wget <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/autoconf-2.69.tar.gz\">https://sourceforge.net/projects/erik1314/files/lanmp/autoconf-2.69.tar.gz</a></p>\n<p> wget  <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/freetype-2.4.10.tar.gz\">https://sourceforge.net/projects/erik1314/files/lanmp/freetype-2.4.10.tar.gz</a></p>\n<p> wget  <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/gd-2.0.35.tar.gz\">https://sourceforge.net/projects/erik1314/files/lanmp/gd-2.0.35.tar.gz</a></p>\n<p> wget  <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/httpd-2.2.27.tar.gz\">https://sourceforge.net/projects/erik1314/files/lanmp/httpd-2.2.27.tar.gz</a></p>\n<p> wget  <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/jpegsrc.v8b.tar.gz\">https://sourceforge.net/projects/erik1314/files/lanmp/jpegsrc.v8b.tar.gz</a></p>\n<p> wget  <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/libmcrypt-2.5.8.tar.gz\">https://sourceforge.net/projects/erik1314/files/lanmp/libmcrypt-2.5.8.tar.gz</a></p>\n<p> wget  <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/libpng-1.5.14.tar.gz\">https://sourceforge.net/projects/erik1314/files/lanmp/libpng-1.5.14.tar.gz</a></p>\n<p> wget  <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/libxml2-2.9.0.tar.gz\">https://sourceforge.net/projects/erik1314/files/lanmp/libxml2-2.9.0.tar.gz</a></p>\n<p> wget  <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/mysql-5.1.42.tar.gz\">https://sourceforge.net/projects/erik1314/files/lanmp/mysql-5.1.42.tar.gz</a></p>\n<p> wget  <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/ncurses-5.6.tar.gz\">https://sourceforge.net/projects/erik1314/files/lanmp/ncurses-5.6.tar.gz</a></p>\n<p> wget  h<a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/phpMyAdmin-3.5.6-all-languages.tar.gz\">https://sourceforge.net/projects/erik1314/files/lanmp/phpMyAdmin-3.5.6-all-languages.tar.gz</a></p>\n<p> wget  <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/zlib-1.2.7.tar.gz\">https://sourceforge.net/projects/erik1314/files/lanmp/zlib-1.2.7.tar.gz</a></p>\n<p> wget  <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/php-5.2.17.tar.gz\">https://sourceforge.net/projects/erik1314/files/lanmp/php-5.2.17.tar.gz</a>     （可根据网站情况选择版本）</p>\n<p>wget  <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/php-5.3.29.tar.gz\">https://sourceforge.net/projects/erik1314/files/lanmp/php-5.3.29.tar.gz</a></p>\n<p>wget <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/php-5.4.11.tar.gz\">https://sourceforge.net/projects/erik1314/files/lanmp/php-5.4.11.tar.gz</a></p>\n<p>wget  <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/php-5.4.33.tar.gz\">https://sourceforge.net/projects/erik1314/files/lanmp/php-5.4.33.tar.gz</a></p>\n<p>wget  <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/php-5.5.17.tar.gz\">https://sourceforge.net/projects/erik1314/files/lanmp/php-5.5.17.tar.gz</a></p>\n<p>wget  <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/php-5.6.1.tar.gz\">https://sourceforge.net/projects/erik1314/files/lanmp/php-5.6.1.tar.gz</a></p>\n<p> wget  <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/ZendOptimizer-3.3.3-linux-glibc23-x86_64.tar.gz\">https://sourceforge.net/projects/erik1314/files/lanmp/ZendOptimizer-3.3.3-linux-glibc23-x86_64.tar.gz</a></p>\n<p>php5.3以上不支持zendoptimizer用ZendGuard替换</p>\n<p>wget  <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/ZendGuard-5\\_5\\_0.tar.gz\">https://sourceforge.net/projects/erik1314/files/lanmp/ZendGuard-5\\_5\\_0.tar.gz</a></p>\n<p>win系统直接下载，再用ftp上传到服务器 <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/autoconf-2.69.tar.gz\">autoconf-2.69.tar.gz</a> <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/freetype-2.4.10.tar.gz\">freetype-2.4.10.tar.gz</a> <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/gd-2.0.35.tar.gz\">gd-2.0.35.tar.gz</a> <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/httpd-2.2.27.tar.gz\">httpd-2.2.27.tar.gz</a> <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/jpegsrc.v8b.tar.gz\">jpegsrc.v8b.tar.gz</a> <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/libmcrypt-2.5.8.tar.gz\">libmcrypt-2.5.8.tar.gz</a> <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/libpng-1.5.14.tar.gz\">libpng-1.5.14.tar.gz</a> <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/libxml2-2.9.0.tar.gz\">libxml2-2.9.0.tar.gz</a> <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/mysql-5.1.42.tar.gz\">mysql-5.1.42.tar.gz</a> <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/ncurses-5.6.tar.gz\">ncurses-5.6.tar.gz</a> <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/phpMyAdmin-3.5.6-all-languages.tar.gz\">phpMyAdmin-3.5.6-all-languages.tar.gz</a> <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/zlib-1.2.7.tar.gz\">zlib-1.2.7.tar.gz</a> <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/php-5.2.17.tar.gz\">php-5.2.17.tar.gz</a> <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/php-5.3.29.tar.gz\">php-5.3.29.tar.gz</a> <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/php-5.4.11.tar.gz\">php-5.4.11.tar.gz</a> <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/php-5.4.33.tar.gz\">php-5.4.33.tar.gz</a> <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/php-5.5.17.tar.gz\">php-5.5.17.tar.gz</a> <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/php-5.6.1.tar.gz\">php-5.6.1.tar.gz</a> <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/ZendOptimizer-3.3.3-linux-glibc23-x86_64.tar.gz\">ZendOptimizer-3.3.3-linux-glibc23-x86_64.tar.gz</a> <a href=\"https://sourceforge.net/projects/erik1314/files/lanmp/ZendGuard-5_5_0.tar.gz\">ZendGuard-5_5_0.tar.gz</a> 依次解压文件</p>\n<p>(六)开始搭建lamp环境 安装三步走configure —-make —-make install configure 检测系统配置，检测软件安装所需要的软件。 make 编译二进制文件为可执行文件。 make install 安装软件。 1.编译安装xml2</p>\n<p>[root@delphi lamp]#cd libxml2-2.6.30<br>[root@delphi libxml2-2.6.30]# ./configure —prefix=/usr/local/libxml2/<br>[root@delphi libxml2-2.6.30]# make &amp;&amp; make install</p>\n<p>  2.同样的方法安装libmcrpyt</p>\n<p>[root@delphi lamp]# cd libmcrypt-2.5.8<br>[root@delphi libmcrypt-2.5.8]# ./configure —prefix=/usr/local/libmcrypt/<br>[root@delphi libmcrypt-2.5.8]# make &amp;&amp; make install</p>\n<p>  3.编译安装zlib （zlib是个库文件，这里为了防止后期出错，不用指定路径，如果是64位系统，请参见安装libpng排错的方法安装。）</p>\n<p>[root@delphi lamp]# cd zlib-1.2.3<br>[root@delphi zlib-1.2.3]# ./configure<br>[root@delphi zlib-1.2.3]# make &amp;&amp; make install</p>\n<p>  编译安装libpng如果出现如下错误，是应为你的环境是64位系统，匹配不了zlib库。 /usr/local/lib/libz.a: could not read symbols: Bad value collect2: ld returned 1 exit status make[1]: <strong><em> [libpng12.la] 错误 1 make[1]: Leaving directory `/root/packget/libpng-1.2.31’ make: </em></strong> [all] 错误 2 解决办法：重新新安装 zlib tar -zxvf zlib-1.2.3.tar.gz cd zlib-1.2.3 ./configure vi Makefile 找到 CFLAGS=-O3 -DUSE_MMAP 在后面加入-fPIC，即变成CFLAGS=-O3 -DUSE_MMAP -fPIC 接下面步骤 make make install   4.编译安装libpng</p>\n<p>[root@delphi lamp]# cd libpng-1.2.31<br>[root@delphi libpng-1.2.31]# ./configure -prefix=/usr/local/libpng/<br>[root@delphi libpng-1.2.31]# make &amp;&amp; make install</p>\n<p>  5.安装jpeg6 这源码包的安装相对复杂一点。因为其不会自动创建对应的目录，首先我们自己手动建立目录 /usr/local/jpeg6/ #创建安装目录 /usr/local/jpeg6/bin/ #创建可执行文件目录 /usr/local/jpeg6/lib/ #创建库文件爱你存放目录 /usr/local/jpeg6/include #创建头文件存放目录 /usr/local/jpeg6/man/man1 #创建man手册中的命令帮助，man1指的是命令帮助， man5配置文件的帮助。</p>\n<p>[root@delphi lamp]# cd jpeg-6b/<br>[root@delphi jpeg-6b]# mkdir /usr/local/jpeg6/ &amp;&amp; mkdir /usr/local/jpeg6/bin/ &amp;&amp; mkdir /usr/local/jpeg6/lib/ &amp;&amp; mkdir /usr/local/jpeg6/include<br>[root@delphi jpeg-6b]# mkdir -p /usr/local/jpeg6/man/man1</p>\n<p>[root@delphi jpeg-6b]# ./configure —prefix=/usr/local/jpeg6/ —enable-shared —enable-static<br>[root@delphi jpeg-6b]# make &amp;&amp; make install</p>\n<p>  ************************************************************************* ./libtool —mode=compile gcc -O2 -I. -c ./jcapimin.c make: ./libtool：命令未找到 make: <strong><em> [jcapimin.lo] 错误 127 出现以上错误的解决办法： [root@delphi jpeg-6b]# cp /usr/share/libtool/config/config.sub /root/packget/jpeg-6b/ [root@delphi jpeg-6b]# cp /usr/share/libtool/config/config.guess /root/packget/jpeg-6b/ 然后： [root@delphi jpeg-6b]# make clean 再执行： [root@delphi jpeg-6b]# make [root@delphi jpeg-6b]# make install <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></em></strong>   6.编译安装freetype</p>\n<p>[root@delphi lamp]# cd freetype-2.3.5<br>[root@delphi freetype-2.3.5]# ./configure —prefix=/usr/local/freetype/<br>[root@delphi freetype-2.3.5]# make &amp;&amp; make install</p>\n<p>  7.编译安装autoconf</p>\n<p>[root@delphi lamp]# cd autoconf-2.61<br>[root@delphi autoconf-2.61]# ./configure<br>[root@delphi autoconf-2.61]# make &amp;&amp; make install</p>\n<p>  8.编译安装gd库：</p>\n<p>[root@delphi lamp]# cd gd-2.0.35<br>[root@delphi gd-2.0.35]# ./configure —prefix=/usr/local/gd2/ —with-jpeg=/usr/local/jpeg6/ —with-freetype=/usr/local/freetype/</p>\n<h1 id=\"备注一下：这里如果你的zlib库是指定路径，那么可以—with-zlib-PATH\"><a href=\"#备注一下：这里如果你的zlib库是指定路径，那么可以—with-zlib-PATH\" class=\"headerlink\" title=\"备注一下：这里如果你的zlib库是指定路径，那么可以—with-zlib=/$PATH\"></a>备注一下：这里如果你的zlib库是指定路径，那么可以—with-zlib=/$PATH</h1><p>[root@delphi gd-2.0.35]# make &amp;&amp; make install</p>\n<p>  9.编译安装apache:</p>\n<p>[root@delphi lamp]# cd httpd-2.2.9<br>[root@delphi httpd-2.2.9]# ./configure —prefix=/usr/local/apache2/ —sysconfdir=/etc/httpd/ —with-included-apr —disable-userdir —enable-so —enable-deflate=shared —enable-expires=shared —enable-rewrite=shared —enable-static-support<br>[root@delphi httpd-2.2.9]# make &amp;&amp; make install</p>\n<p>[root@delphi httpd-2.2.9]# /usr/local/apache2/bin/apachectl start<br>[root@delphi httpd-2.2.9]# pgrep httpd<br>27652<br>27653<br>27654<br>27655<br>27656<br>27657</p>\n<p>如果没有禁止selinux 那么使用如下命令开启模块权限： [root@delphi ~]# chcon -t texrel_shlib_t modulename 通过浏览器访问服务器，如果反回It‘s works ！ 表示安装成功。   10.编译安装mysql之前需要安装编译nourses:</p>\n<p>[root@delphi lamp]# cd ncurses-5.6<br>[root@delphi ncurses-5.6]# ./configure —with-shared —without-debug —without-ada —enable-overwrite<br>[root@delphi ncurses-5.6]# make &amp;&amp; make install</p>\n<p>  11.编译安装mysql： 首先创建mysql用户以及用户组：</p>\n<p>[root@delphi lamp]# cd mysql-5.0.41<br>[root@delphi mysql-5.0.41]# groupadd mysql<br>[root@delphi mysql-5.0.41]# grep mysql /etc/group<br>mysql:x:501:<br>[root@delphi mysql-5.0.41]# useradd -g mysql mysql</p>\n<p>[root@delphi mysql-5.0.41]# ./configure —prefix=/usr/local/mysql —with-extra-charsets=all<br>[root@delphi mysql-5.0.41]# make &amp;&amp; make instal<br>make报错的话就用</p>\n<p>make ZEND_EXTRA_LIBS=’-liconv’ &amp;&amp; make install</p>\n<p>  配置mysql：把源码包中的my-medium.cnf拷贝的/etc/下命名为my.cnf</p>\n<p>[root@delphi mysql-5.0.41]# cp support-files/my-medium.cnf /etc/my.cnf</p>\n<p>启动用户的授权表：</p>\n<p>[root@delphi mysql-5.0.41]# /usr/local/mysql/bin/mysql_install_db —user=mysql</p>\n<p>改变目录权限：</p>\n<p>[root@delphi mysql-5.0.41]# chown -R root /usr/local/mysql     #改变mysql所属用户<br>[root@delphi mysql-5.0.41]# chown -R mysql /usr/local/mysql/var     #改变mysql下var这个目录所属用户<br>[root@delphi mysql-5.0.41]# chgrp -R mysql /usr/local/mysql     #改变mysql的所属组，这里的-Ｒ是权限继承到子目录</p>\n<p>启动：mysql</p>\n<p>[root@delphi mysql-5.0.41]# /usr/local/mysql/bin/mysqld_safe —user=mysql &amp;<br>[1] 25856<br>[root@delphi mysql-5.0.41]# nohup: 忽略输入重定向错误到标准输出端<br>Starting mysqld daemon with databases from /usr/local/mysql/var     #表示数据存放路径。回车既可。</p>\n<p>查看mysql是否启动：</p>\n<p>[root@delphi mysql-5.0.41]# pgrep mysql</p>\n<p>查看mysql的版本：</p>\n<p>[root@delphi mysql-5.0.41]# /usr/local/mysql/bin/mysqladmin version</p>\n<p>查看mysql配置参数：</p>\n<p>[root@delphi mysql-5.0.41]# /usr/local/mysql/bin/mysqladmin variables</p>\n<p>  设置ｍｙｓｑｌ的用户密码：</p>\n<p>[root@delphi mysql-5.0.41]# /usr/local/mysql/bin/mysql -uroot<br>Welcome to the MySQL monitor. Commands end with ; or \\g.<br>Your MySQL connection id is 3<br>Server version: 5.0.41-log Source distribution</p>\n<p>Type ‘help;’ or ‘\\h’ for help. Type ‘\\c’ to clear the buffer.</p>\n<p>mysql&gt; set password for ‘root’@’localhost’=PASSWORD(‘123456’);<br>Query OK, 0 rows affected (0.00 sec)</p>\n<p>mysql&gt; flush privileges;<br>Query OK, 0 rows affected (0.00 sec)</p>\n<p>mysql&gt; exit<br>Bye</p>\n<p>  把apache和mysql 加入启动项</p>\n<p>[root@delphi mysql-5.0.41]# echo “/usr/local/apache2/bin/apachectl start” &gt;&gt;/etc/rc.d/rc.local<br>[root@delphi mysql-5.0.41]# echo “/usr/local/mysql/bin/mysqld_safe —user=mysql &amp;” &gt;&gt; /etc/rc.d/rc.local</p>\n<p>  或者：</p>\n<p>[root@delphi ~]# cd lamp/mysql-5.0.41<br>[root@delphi mysql-5.0.41]# cp support-files/mysql.server /etc/rc.d/init.d/mysqld<br>[root@delphi mysql-5.0.41]# chown root.root /etc/rc.d/init.d/mysqld<br>[root@delphi mysql-5.0.41]# chmod 755 /etc/rc.d/init.d/mysqld<br>[root@delphi mysql-5.0.41]# chkconfig —add mysqld<br>[root@delphi mysql-5.0.41]# chkconfig —list mysqld<br>mysqld 0:关闭1:关闭2:启用3:启用4:启用5:启用6:关闭<br>[root@delphi mysql-5.0.41]# chkconfig —levels 245 mysqld off　#设置运行级别启动项的方法．<br>[root@delphi mysql-5.0.41]# chkconfig —list mysqld　<br>mysqld 0:关闭1:关闭2:关闭3:启用4:关闭5:关闭6:关闭<br>[root@delphi mysql-5.0.41]# chkconfig —levels 245 mysqld on #更改回原来的运行级别</p>\n<p>  12.安装php:</p>\n<p>[root@delphi lamp]# cd php-5.2.6<br>[root@delphi php-5.2.6]# ./configure —prefix=/usr/local/php/ —with-config-file-path=/usr/local/php/etc —with-apxs2=/usr/local/apache/bin/apxs —with-mysql=/usr/local/mysql/ —with-libxml-dir=/usr/local/libxml2/ —with-jpeg-dir=/usr/local/jpeg8/ —with-freetype-dir=/usr/local/freetype/ —with-gd —with-mcrypt=/usr/local/libmcrypt/ —with-mysqli=/usr/local/mysql/bin/mysql_config –with-curl=/usr/local/curl<br>—with-zlib-dir=/usr/local/zlib/ —with-png-dir=/usr/local/libpng/ —with-mysql —enable-soap —enable-mbstring=all—enable-sockets<br>或者<br>直接生成curl，后面就不用重新编译生成了<br>./configure —prefix=/usr/local/php/ —with-apxs2=/usr/local/apache/bin/apxs —with-curl=/usr/local/curl/bin —with-libxml-dir=/usr/local/libxml2/ —with-jpeg-dir=/usr/local/jpeg/ —with-freetype-dir=/usr/local/freetype/—with-gd-dir=/usr/local/gd/—with-zlib-dir=/usr/local/zlib/—with-mcrypt=/usr/local/libmcrypt/—with-mysqli=/usr/local/mysql/bin/mysql_config —enable-soap —enable-mbstring=all —enable-sockets<br> [root@delphi php-5.2.6]# make &amp;&amp; make install<br>这边make instal后回报错，原作者没给我给个答案<br>类似以下错误<br>/opt/php-5.2.17/ext/dom/node.c -o ext/dom/node.lo<br>/opt/php-5.2.17/ext/dom/node.c: In function â€کdom_canonicalizationâ€™:<br>/opt/php-5.2.17/ext/dom/node.c:1953: error: dereferencing pointer to incomplete type<br>/opt/php-5.2.17/ext/dom/node.c:1955: error: dereferencing pointer to incomplete type<br>make: <em>*</em> [ext/dom/node.lo] Error 1</p>\n<p>可用<br># curl -o php-5.2.17.patch <a href=\"https://mail.gnome.org/archives/xml/2012-August/txtbgxGXAvz4N.txt\">https://mail.gnome.org/archives/xml/2012-August/txtbgxGXAvz4N.txt</a></p>\n<h1 id=\"cd-php-5-2-17\"><a href=\"#cd-php-5-2-17\" class=\"headerlink\" title=\"cd php-5.2.17\"></a>cd php-5.2.17</h1><p># patch -p0 -b &lt; ./php-5.2.17.patch<br>   patching file ext/dom/node.c<br>   patching file<br>   ext/dom/documenttype.c<br>   patching file ext/simplexml/simplexml.c<br>然后重新编译，安装，记得make clean 一下<br>出现</p>\n<p>make: <em>*</em> [sapi/cli/php] 错误 1</p>\n<p>在make时改为 make ZEND_EXTRA_LIBS=’-liconv’ &amp;&amp; make install<br>  [root@delphi php-5.2.6]# cp php.ini-dist /usr/local/php/etc/php.ini[root@delphi php-5.2.6]# echo “Addtype application/x-httpd-php .php .phtml” &gt;&gt; /etc/httpd/httpd.conf[root@delphi php-5.2.6]# /usr/local/apache2/bin/apachectl restart</p>\n<p>cp php.ini-dist /usr/local/php/etc/php.ini</p>\n<p>vi /usr/local/apache/conf/httpd.conf</p>\n<p>在 AddType application/x-compress .Z</p>\n<pre><code> AddType application/x-gzip .gz .tgz\n</code></pre><p> 后面添加 Addtype application/x-httpd-php .php .phtml</p>\n<pre><code> Addtype application/x-httpd-php-source .phps\n</code></pre><p>13.安装Zend加速器</p>\n<p>[root@delphi lamp]# cd ZendOptimizer-3.2.6-linux-glibc21-i386<br>[root@delphi ZendOptimizer-3.2.6-linux-glibc21-i386]# ./install.sh</p>\n<p>  安装过程选择正确的 php.ini 文件所在目录 和 apache控制命令所在目录   14.安装 phpmyadmin 方便管理mysql数据库</p>\n<p>[root@delphi lamp]# mv phpMyAdmin-3.0.0-rc1-all-languages /usr/local/apache2/htdocs/phpmyadmin</p>\n<p>笔者在编译php时遇到诸多问题，也是一步步百度查询找到答案的，刚配置的centos是不完善的。</p>\n",
            "tags": [
                "php",
                "php服务器",
                "centos",
                "lanmp",
                "php环境独立配置",
                "服务器"
            ]
        }
    ]
}