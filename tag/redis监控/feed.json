{
    "version": "https://jsonfeed.org/version/1",
    "title": "艾瑞可erik • All posts by \"redis监控\" tag • All posts by \"undefined\" categories",
    "description": "一只PHP开发的程序猿，偶尔做做运维、Goland、Python、Java、摄影、画画、写作、顺便睡觉，反正整站都搞过。",
    "home_page_url": "https://erik.xyz",
    "items": [
        {
            "id": "https://erik.xyz/2020/06/20/redis-top/",
            "url": "https://erik.xyz/2020/06/20/redis-top/",
            "title": "Redis性能指标监控",
            "date_published": "2020-06-20T07:31:00.000Z",
            "content_html": "<h5 id=\"监控指标\"><a href=\"#监控指标\" class=\"headerlink\" title=\"监控指标\"></a>监控指标</h5><ul>\n<li>性能指标：Performance</li>\n<li>内存指标: Memory</li>\n<li>基本活动指标：Basic activity</li>\n<li>持久性指标: Persistence</li>\n<li>错误指标：Error<span id=\"more\"></span>\n<h5 id=\"性能指标：Performance\"><a href=\"#性能指标：Performance\" class=\"headerlink\" title=\"性能指标：Performance\"></a>性能指标：Performance</h5></li>\n</ul>\n<div class=\"table-container\">\n<table>\n<thead>\n<tr>\n<th>Name</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>latency</td>\n<td>Redis响应一个请求的时间</td>\n</tr>\n<tr>\n<td>instantaneous_ops_per_sec</td>\n<td>平均每秒处理请求总数</td>\n</tr>\n<tr>\n<td>hi rate(calculated)</td>\n<td>缓存命中率（计算出来的</td>\n</tr>\n</tbody>\n</table>\n</div>\n<h5 id=\"内存指标-Memory\"><a href=\"#内存指标-Memory\" class=\"headerlink\" title=\"内存指标: Memory\"></a>内存指标: Memory</h5><div class=\"table-container\">\n<table>\n<thead>\n<tr>\n<th>Name</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>used_memory</td>\n<td>已使用内存</td>\n</tr>\n<tr>\n<td>mem_fragmentation_ratio</td>\n<td>内存碎片率</td>\n</tr>\n<tr>\n<td>evicted_keys</td>\n<td>由于最大内存限制被移除的key的数量</td>\n</tr>\n<tr>\n<td>blocked_clients</td>\n<td>由于BLPOP,BRPOP,or BRPOPLPUSH而备阻塞的客户端</td>\n</tr>\n</tbody>\n</table>\n</div>\n<h5 id=\"基本活动指标：Basic-activity\"><a href=\"#基本活动指标：Basic-activity\" class=\"headerlink\" title=\"基本活动指标：Basic activity\"></a>基本活动指标：Basic activity</h5><div class=\"table-container\">\n<table>\n<thead>\n<tr>\n<th>Name</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>connected_clients</td>\n<td>客户端连接数</td>\n</tr>\n<tr>\n<td>conected_laves</td>\n<td>slave数量</td>\n</tr>\n<tr>\n<td>master_last_io_seconds_ago</td>\n<td>最近一次主从交互之后的秒数</td>\n</tr>\n<tr>\n<td>keyspace</td>\n<td>数据库中的key值总数</td>\n</tr>\n</tbody>\n</table>\n</div>\n<h5 id=\"持久性指标-Persistence\"><a href=\"#持久性指标-Persistence\" class=\"headerlink\" title=\"持久性指标: Persistence\"></a>持久性指标: Persistence</h5><div class=\"table-container\">\n<table>\n<thead>\n<tr>\n<th>Name</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>rdb_last_save_time</td>\n<td>最后一次持久化保存磁盘的时间戳</td>\n</tr>\n<tr>\n<td>rdb_changes_sice_last_save</td>\n<td>自最后一次持久化以来数据库的更改数</td>\n</tr>\n</tbody>\n</table>\n</div>\n<h5 id=\"错误指标：Error\"><a href=\"#错误指标：Error\" class=\"headerlink\" title=\"错误指标：Error\"></a>错误指标：Error</h5><div class=\"table-container\">\n<table>\n<thead>\n<tr>\n<th>Name</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>rejected_connections</td>\n<td>由于达到maxclient限制而被拒绝的连接数</td>\n</tr>\n<tr>\n<td>keyspace_misses</td>\n<td>key值查找失败(没有命中)次数</td>\n</tr>\n<tr>\n<td>master_link_down_since_seconds</td>\n<td>主从断开的持续时间（以秒为单位)</td>\n</tr>\n</tbody>\n</table>\n</div>\n<h5 id=\"监控方式\"><a href=\"#监控方式\" class=\"headerlink\" title=\"监控方式\"></a>监控方式</h5><ul>\n<li>redis-benchmark</li>\n<li>redis-stat</li>\n<li>redis-faina</li>\n<li>redislive</li>\n<li>redis-cli</li>\n<li>monitor</li>\n<li>showlog</li>\n</ul>\n<p>1.get：获取慢查询日志</p>\n<p>2.len：获取慢查询日志条目数</p>\n<p>3.reset：重置慢查询日志</p>\n<p>相关配置：</p>\n<pre><code>slowlog-log-slower-than 1000 # 设置慢查询的时间下线，单位：微秒\nslowlog-max-len 100 # 设置慢查询命令对应的日志显示长度，单位：命令数\n</code></pre><p>info（可以一次性获取所有的信息，也可以按块获取信息）</p>\n<p>1.server:服务器运行的环境参数</p>\n<p>2.clients:客户端相关信息</p>\n<p>3.memory：服务器运行内存统计数据</p>\n<p>4.persistence：持久化信息</p>\n<p>5.stats：通用统计数据</p>\n<p>6.Replication：主从复制相关信息</p>\n<p>7.CPU：CPU使用情况</p>\n<p>8.cluster：集群信息</p>\n<p>9.Keypass：键值对统计数量信息</p>\n<h5 id=\"终端info命令使用\"><a href=\"#终端info命令使用\" class=\"headerlink\" title=\"终端info命令使用\"></a>终端info命令使用</h5><pre><code>./redis-cli info 按块获取信息 | grep 需要过滤的参数\n\n./redis-cli info stats | grep ops\n</code></pre><h5 id=\"交互式info命令使用\"><a href=\"#交互式info命令使用\" class=\"headerlink\" title=\"交互式info命令使用\"></a>交互式info命令使用</h5><pre><code> #./redis-cli \n&gt; info server\n</code></pre><h5 id=\"性能监控：\"><a href=\"#性能监控：\" class=\"headerlink\" title=\"性能监控：\"></a>性能监控：</h5><pre><code>redis-cli info | grep ops # 每秒操作数\n</code></pre><h5 id=\"内存监控\"><a href=\"#内存监控\" class=\"headerlink\" title=\"内存监控\"></a>内存监控</h5><pre><code>[root@CombCloud-2020110836 src]# ./redis-cli info | grep used | grep human       \nused_memory_human:2.99M  # 内存分配器从操作系统分配的内存总量\nused_memory_rss_human:8.04M  #操作系统看到的内存占用，top命令看到的内存\nused_memory_peak_human:7.77M # redis内存消耗的峰值\nused_memory_lua_human:37.00K   # lua脚本引擎占用的内存大小\n</code></pre><h5 id=\"由于BLPOP-BRPOP-or-BRPOPLPUSH而备阻塞的客户端\"><a href=\"#由于BLPOP-BRPOP-or-BRPOPLPUSH而备阻塞的客户端\" class=\"headerlink\" title=\"由于BLPOP,BRPOP,or BRPOPLPUSH而备阻塞的客户端\"></a>由于BLPOP,BRPOP,or BRPOPLPUSH而备阻塞的客户端</h5><pre><code>[root@CombCloud-2020110836 src]# ./redis-cli info | grep blocked_clients\nblocked_clients:0  \n</code></pre><h5 id=\"由于最大内存限制被移除的key的数量\"><a href=\"#由于最大内存限制被移除的key的数量\" class=\"headerlink\" title=\"由于最大内存限制被移除的key的数量\"></a>由于最大内存限制被移除的key的数量</h5><pre><code>[root@CombCloud-2020110836 src]# ./redis-cli info | grep evicted_keys\nevicted_keys:0  #\n</code></pre><h5 id=\"内存碎片率\"><a href=\"#内存碎片率\" class=\"headerlink\" title=\"内存碎片率\"></a>内存碎片率</h5><pre><code>[root@CombCloud-2020110836 src]# ./redis-cli info | grep mem_fragmentation_ratio\nmem_fragmentation_ratio:2.74 \n</code></pre><h5 id=\"已使用内存\"><a href=\"#已使用内存\" class=\"headerlink\" title=\"已使用内存\"></a>已使用内存</h5><pre><code>[root@CombCloud-2020110836 src]# ./redis-cli info | grep used_memory:\nused_memory:3133624  \n</code></pre><h5 id=\"基本活动指标：\"><a href=\"#基本活动指标：\" class=\"headerlink\" title=\"基本活动指标：\"></a>基本活动指标：</h5><p>redis连接了多少客户端 通过观察其数量可以确认是否存在意料之外的连接。如果发现数量不对劲，就可以使用lcient list指令列出所有的客户端链接地址来确定源头。</p>\n<pre><code>[root@CombCloud-2020110836 src]# ./redis-cli info | grep connected_clients\nconnected_clients:1\n\n\n[root@CombCloud-2020110836 src]# ./redis-cli info | grep connected\nconnected_clients:1   # 客户端连接数量\nconnected_slaves:1   # slave连接数量\n</code></pre><h5 id=\"持久性指标：\"><a href=\"#持久性指标：\" class=\"headerlink\" title=\"持久性指标：\"></a>持久性指标：</h5><pre><code>[root@CombCloud-2020110836 src]# ./redis-cli info | grep rdb_last_save_time\nrdb_last_save_time:1591876204  # 最后一次持久化保存磁盘的时间戳\n[root@CombCloud-2020110836 src]# ./redis-cli info | grep rdb_changes_since_last_save\nrdb_changes_since_last_save:0   # 自最后一次持久化以来数据库的更改数\n</code></pre><h5 id=\"错误指标\"><a href=\"#错误指标\" class=\"headerlink\" title=\"错误指标\"></a>错误指标</h5><p>由于超出最大连接数限制而被拒绝的客户端连接次数，如果这个数字很大，则意味着服务器的最大连接数设置得过低，需要调整maxclients</p>\n<pre><code>[root@CombCloud-2020110836 src]# ./redis-cli info | grep connected_clients\nconnected_clients:1\n</code></pre><p>key值查找失败(没有命中)次数，出现多次可能是被hei ke gongjji</p>\n<pre><code>[root@CombCloud-2020110836 src]# ./redis-cli info | grep keyspace\nkeyspace_misses:0   \n</code></pre><p>主从断开的持续时间（以秒为单位)</p>\n<pre><code>[root@CombCloud-2020110836 src]# ./redis-cli info | grep rdb_changes_since_last_save\nrdb_changes_since_last_save:0  \n</code></pre><p>复制积压缓冲区如果设置得太小，会导致里面的指令被覆盖掉找不到偏移量，从而触发全量同步</p>\n<pre><code>[root@CombCloud-2020110836 src]# ./redis-cli info | grep backlog_size\nrepl_backlog_size:1048576\n</code></pre><p>通过查看sync_partial_err变量的次数来决定是否需要扩大积压缓冲区，它表示主从半同步复制失败的次数</p>\n<pre><code>[root@CombCloud-2020110836 src]# ./redis-cli info | grep sync_partial_err\nsync_partial_err:1\n</code></pre><p>redis性能测试命令</p>\n<pre><code>./redis-benchmark -c 100 -n 5000\n</code></pre><p>原创地址：<a href=\"https://mp.weixin.qq.com/s/gu1ZLXlR9ud4wnssYMVkMw\">https://mp.weixin.qq.com/s/gu1ZLXlR9ud4wnssYMVkMw</a></p>\n",
            "tags": [
                "redis",
                "redis监控"
            ]
        }
    ]
}