{
    "version": "https://jsonfeed.org/version/1",
    "title": "艾瑞可erik • All posts by \"zookeeper3.5.5\" tag • All posts by \"undefined\" categories",
    "description": "一只PHP开发的程序猿，偶尔做做运维、Goland、Python、Java、摄影、画画、写作、顺便睡觉，反正整站都搞过。",
    "home_page_url": "https://erik.xyz",
    "items": [
        {
            "id": "https://erik.xyz/2019/07/30/php-pei-zhi-zookeeper3-5-5-kuo-zhan/",
            "url": "https://erik.xyz/2019/07/30/php-pei-zhi-zookeeper3-5-5-kuo-zhan/",
            "title": "php配置zookeeper3.5.5扩展",
            "date_published": "2019-07-30T03:16:00.000Z",
            "content_html": "<p>这两天想用用zookeeper，顺便做个提升。查了下官方给出的3.5.5和3.4.14。而php手册也有介绍配置方法，不过扩展好久没更新，就是试试用了。</p>\n<p>下载php-zookeeper扩展，放到本地编译、安装。在执行make命令的时候总是报错缺少lzookeeper_mt.so库。<br>官方搜索教程都是老版本的，说是在文件根目录src/c下生成库。可是我用的是3.5.5版本的，目录下根本没有。<br>根据官方文档可知，新版本分为bin和源码版，也就是说bin是编译好的，下载后配置一下cfg文件就可以用了。<br><span id=\"more\"></span></p>\n<p>我下载的是bin版，已经编译好的，那就下载源码（<a href=\"https://www-us.apache.org/dist/zookeeper/,\">zookeeper下载</a>）版吧。在3.5.5中需要使用c端就必须编译安装库，在项目根目录下zookeeper-client中，怎么编译呢很懵逼。看官方文档（<a href=\"https://erik.xyz/dev_books/zookeeper3.5.5/zookeeperProgrammers.html#C+Binding,,\">zookeeper3.5.5手册</a>）是这样说的</p>\n<p><img src=\"/img/201907/2019-07-30_18-10.jpg\" alt=\"\"></p>\n<p>感觉很复杂，其实梳理一下就明白了。不过我这被坑好几天。<br>先在zookeeper根目录下执行 ant compile_jute 命令，在zookeeper-client/zookeeper-client-c下生成目录generated</p>\n<p>然后在zookeeper-client/zookeeper-client-c执行命令autoreconf -if 如果此时报错，一般就是autoconf，automake和libtool这个三个软件没安装，安装好后重新执行autoreconf -if</p>\n<p>最后执行 ./configure –enable-debug 如果是开发或者测试环境就加–enable-debug</p>\n<p>接下make一下，一般来说到这里会报错<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rc/zookeeper.c: In function ‘print_completion_queue’:</span><br><span class=\"line\">src/zookeeper.c:2542:5: error: null argument where non-null required (argument 1) [-Werror=nonnull]</span><br><span class=\"line\">     fprintf(LOGSTREAM,&quot;Completion queue: &quot;,&quot;empty\\n&quot;);</span><br><span class=\"line\">     ^~~~~~~</span><br><span class=\"line\">src/zookeeper.c:2542:23: error: too many arguments for format [-Werror=format-extra-args]</span><br><span class=\"line\">     fprintf(LOGSTREAM,&quot;Completion queue: &quot;,&quot;empty\\n&quot;);</span><br><span class=\"line\">                       ^~~~~~~~~~~~~~~~~~~~</span><br><span class=\"line\">src/zookeeper.c:2550:9: error: null argument where non-null required (argument 1) [-Werror=nonnull]</span><br><span class=\"line\">         fprintf(LOGSTREAM,&quot;%d,&quot;,cptr-&gt;xid);</span><br><span class=\"line\">         ^~~~~~~</span><br><span class=\"line\">src/zookeeper.c:2553:5: error: null argument where non-null required (argument 1) [-Werror=nonnull]</span><br><span class=\"line\">     fprintf(LOGSTREAM,&quot;end\\n&quot;);</span><br><span class=\"line\">     ^~~~~~~</span><br><span class=\"line\">src/zookeeper.c: In function ‘format_endpoint_info’:</span><br><span class=\"line\">src/zookeeper.c:4410:21: error: ‘%d’ directive writing between 1 and 5 bytes into a region of size between 0 and 127 [-Werror=format-overflow=]</span><br><span class=\"line\">     sprintf(buf,&quot;%s:%d&quot;,addrstr,ntohs(port));</span><br><span class=\"line\">                     ^~</span><br><span class=\"line\">src/zookeeper.c:4410:17: note: directive argument in the range [0, 65535]</span><br><span class=\"line\">     sprintf(buf,&quot;%s:%d&quot;,addrstr,ntohs(port));</span><br><span class=\"line\">                 ^~~~~~~</span><br><span class=\"line\">src/zookeeper.c:4410:5: note: ‘sprintf’ output between 3 and 134 bytes into a destination of size 128</span><br><span class=\"line\">     sprintf(buf,&quot;%s:%d&quot;,addrstr,ntohs(port));</span><br><span class=\"line\">     ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class=\"line\">cc1: all warnings being treated as errors</span><br></pre></td></tr></table></figure></p>\n<p><img src=\"/img/201907/2019-07-30_14-21.jpg\" alt=\"\"><br>这里卡了好久,通过网上查找才知道编译的时候gcc版本不同。我本地是gcc8.8，立马换系统centos7</p>\n<p>在docker中安装centos7复制zookeeper源码、配置jdk、安装make、vim等软件后，以上步骤重新走一次就生成了，然后把生成的库（lib文件、include文件）复制一份放到本地zookeeper目录</p>\n<p>编译php-zookeeper扩展，执行。、configure的时候指定一下库目录就可以啦。<br>结束了。</p>\n<p>上一份跟官方组合的源码，带编译库<a href=\"https://github.com/erikwang2013/zookeeper3.5.5\">zookeeper3.5.5</a></p>\n<p><img src=\"/img/201907/2019-07-30_18-29.jpg\" alt=\"\"></p>\n",
            "tags": [
                "php",
                "php-zookeeper",
                "zookeeper3.5.5",
                "php-zookeeper扩展"
            ]
        }
    ]
}